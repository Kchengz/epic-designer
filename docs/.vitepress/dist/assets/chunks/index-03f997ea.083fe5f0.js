import{i as j,r as E,m as O,w as q,o as v,c as y,e as x,v as z,u as g,F as U,k as L,j as Q,t as K,d as u,G as $,f as J,E as R,a4 as S,aa as T,ab as P,C as W,H as X,I as G}from"../app.c1700df1.js";import{N as A,c9 as Y,c7 as Z,cl as H,cm as ee}from"./index.fb95377d.js";import{m as D}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.b898144b.js";import{R as te}from"./vuedraggable.umd-6a5b6da9.96e89de6.js";import{e as ae}from"./tree.vue_vue_type_script_setup_true_lang-3a3966af.b5ea456c.js";const le={class:"event-info"},ne=["title"],oe={class:"event-btn"},ie={class:"epic-action-editor-main"},ce={class:"epic-editor-item"},ue={class:"w-36px text-lg"},se={class:"flex-1"},me={key:0},de={key:1},pe={key:2},ve={class:"opr-box"},re=["onClick"],fe=["onClick"],he=j({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(N,{emit:k}){const r=N,b=k,f=L("pageSchema");function C(p){b("add",p)}function V(p){return H(f.schemas,p).label}function d(p,m){var i;const e=t(m);e[m]=r.events[m].filter((_,w)=>p!==w),(i=e[m])!=null&&i.length||delete e[m],b("update:modelValue",e)}function s(p,m,i){b("edit",p,m,i)}function t(p){const m={};return r.allEvents.forEach(i=>{if(!r.events[i.type].length||i.type===p)return!1;m[i.type]=r.events[i.type]}),m}return(p,m)=>(v(!0),y(U,null,R(N.itemEvents,i=>(v(),y("div",{key:i.type,class:"event-item"},[u("div",le,[u("div",{class:"event-label",title:i.describe},S(i.describe),9,ne),u("div",oe,[x(g(D),{name:"icon-tianjia1",onClick:e=>C(i.type)},null,8,["onClick"])])]),u("div",ie,[x(g(te),{modelValue:r.events[i.type],"onUpdate:modelValue":e=>r.events[i.type]=e,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:z(({element:e,index:_})=>[u("div",ce,[u("div",ue,[x(g(D),{class:"mr-2 text-lg cursor-move handle",name:"icon-tuozhuai"})]),u("div",se,[e.type==="component"?(v(),y("div",me,S(V(e.componentId)),1)):e.type==="custom"?(v(),y("div",de," \u81EA\u5B9A\u4E49\u51FD\u6570 ")):e.type==="public"?(v(),y("div",pe," \u516C\u5171\u51FD\u6570 ")):W("",!0),J(" "+S(e.methodName),1)]),u("div",ve,[u("div",{class:"edit-btn",onClick:w=>s(_,i.type,e)},[x(g(D),{name:"icon-tiaozheng"})],8,re),u("div",{class:"del-btn",onClick:w=>d(_,i.type)},[x(g(D),{name:"icon-shanchu1"})],8,fe)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),ye={class:"h-full flex flex-col"},ge=u("div",{class:"pb-2"}," \u81EA\u5B9A\u4E49\u51FD\u6570\u7F16\u8F91 ",-1),Ie=j({__name:"EScriptEdit",setup(N){const k=A.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},b=E(null),f=L("pageSchema");return(C,V)=>(v(),y("div",ye,[ge,x(g(k),{ref_key:"monacoEditorRef",ref:b,modelValue:g(f).script,"onUpdate:modelValue":V[0]||(V[0]=d=>g(f).script=d),class:"editor flex-1",config:r,language:"javascript"},null,8,["modelValue"])]))}}),Ve={class:"epic-attribute-view"},be=["title"],xe={class:"attr-input"},Ce=j({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(N,{emit:k}){const r=N,b=k,f=O(()=>r.modelValue?JSON.parse(r.modelValue):[]);function C(d){var s;return typeof d.show=="boolean"?d.show:typeof d.show=="function"?(s=d.show)==null?void 0:s.call(d,{values:f.value}):!0}function V(d,s){var p;const t=[...JSON.parse((p=r.modelValue)!=null?p:"[]")];t[s]=d,b("update:modelValue",JSON.stringify(t))}return(d,s)=>(v(),y("aside",Ve,[(v(!0),y(U,null,R(r.actionArgsConfigs,t=>(v(),y("div",{key:t.field+t.type},[T(u("div",{class:$(["attr-item",t.layout])},[u("div",{class:"attr-label",title:t.label},S(t.label),9,be),u("div",xe,[x(g(Y),{componentSchema:{...t,componentProps:{...t.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":f.value[t.field],"onUpdate:modelValue":p=>V(p,t.field)},null,8,["componentSchema","model-value","onUpdate:modelValue"])])],2),[[P,C(t)]])]))),128))]))}}),ke={class:"rounded bg-white epic-modal-action-main"},Ne={class:"epic-modal-left-panel h-full flex flex-col"},Ee={class:"flex flex-1 h-0 flex-col"},_e={class:"flex-1 h-0"},we={class:"epic-action-select h-30/100 flex flex-col"},Oe=u("div",{class:"mb-2"},"\u52A8\u4F5C\u9009\u62E9",-1),Ae={class:"flex-1 overflow-auto pr-8px"},Se=["onClick"],Ue={class:"text-center pt-42px text-gray-400"},je={class:"epic-modal-right-panel"},Me={key:1,class:"text-center pt-42px text-gray-400"},De=j({__name:"EActionModal",emits:["add","edit"],setup(N,{expose:k,emit:r}){const b=A.getComponent("modal"),f=E(!0),C=L("pageSchema"),V=L("pageManager",{}),d=E(!1),s=E([]),t=E(null),p=r,m=O(()=>{var l;return e.actionItem.type==="component"?t.value?(l=A.getComponentConfings()[t.value.type].config.action)==null?void 0:l.map(n=>({label:n.describe,value:n.type})):[]:e.actionItem.type==="custom"?Object.entries(V.funcs.value).filter(([n,I])=>typeof I=="function").map(([n])=>({label:n,value:n})):e.actionItem.type==="public"?Object.entries(A.publicMethods).map(([n])=>({label:n,value:n})):[]}),i=O(()=>{var l;if(e.actionItem.type==="component"&&t.value){const n=A.getComponentConfings()[t.value.type].config.action,I=n==null?void 0:n.find(h=>h.type===e.actionItem.methodName);if(I!=null&&I.argsConfigs){const h=I.argsConfigs.findIndex(F=>F.label==="\u8BBE\u7F6E\u6570\u636E");h!==-1&&(I.argsConfigs[h]={...t.value,label:"\u8BBE\u7F6E\u6570\u636E",field:"0",id:Z()})}return(l=I==null?void 0:I.argsConfigs)!=null?l:[]}return[]}),e=Q({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}});function _(){var l;d.value=!0,f.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(l=m.value)!=null&&l.length&&o(m.value[0].value)}function w(l){if(d.value=!0,f.value=!1,t.value=null,l.componentId){const n=H(C.schemas,l.componentId);t.value=n,s.value=[l.componentId]}X(()=>{e.actionItem.componentId=l.componentId,e.actionItem.methodName=l.methodName,e.actionItem.type=l.type,e.actionItem.args=l.args})}function B(){if(!e.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}p(f.value?"add":"edit",ee(G(e.actionItem))),M()}function M(){d.value=!1,s.value=[],e.cacheData={}}function c(l){var n;e.actionItem.componentId=null,e.actionItem.type=l,t.value=null,e.actionItem.methodName=null,s.value=[],(n=m.value)!=null&&n.length&&o(m.value[0].value)}function a(l){var n;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=l.id,e.actionItem.type="component",e.actionItem.methodName=null,t.value=l.componentSchema,(n=m.value)!=null&&n.length&&o(m.value[0].value)}function o(l){e.actionItem.methodName=l,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return k({handleOpen:_,handleOpenEdit:w}),(l,n)=>(v(),K(g(b),{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=I=>d.value=I),class:"w-1200px",width:"1200px",onClose:M,onOk:B,title:"\u52A8\u4F5C\u914D\u7F6E"},{default:z(()=>{var I;return[u("div",ke,[u("div",Ne,[u("div",Ee,[u("div",{class:$(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:n[0]||(n[0]=h=>c("custom"))}," \u81EA\u5B9A\u4E49\u51FD\u6570 ",2),u("div",{class:$(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:n[1]||(n[1]=h=>c("public"))}," \u516C\u5171\u51FD\u6570 ",2),J(" \u7EC4\u4EF6 "),u("div",_e,[x(g(ae),{selectedKeys:s.value,"onUpdate:selectedKeys":n[2]||(n[2]=h=>s.value=h),options:g(C).schemas,onNodeClick:a},null,8,["selectedKeys","options"])])]),u("div",we,[Oe,u("div",Ae,[(v(!0),y(U,null,R(m.value,h=>(v(),y("div",{class:$([{checked:h.value===e.actionItem.methodName},"epic-action-item"]),onClick:F=>o(h.value),key:h.value},[u("span",null,S(h.label),1)],10,Se))),128)),T(u("div",Ue," \u5F53\u524D\u7EC4\u4EF6\u6682\u65E0\u52A8\u4F5C ",512),[[P,!((I=m.value)!=null&&I.length)]])])])]),u("div",je,[e.actionItem.type==="custom"?(v(),K(Ie,{key:0})):i.value.length===0?(v(),y("div",Me," \u6682\u65E0\u914D\u7F6E ")):(v(),K(Ce,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":n[3]||(n[3]=h=>e.actionItem.args=h),actionArgsConfigs:i.value},null,8,["modelValue","actionArgsConfigs"]))])])]}),_:1},8,["modelValue"]))}}),Be=j({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(N,{emit:k}){const r=A.getComponent("Collapse"),b=A.getComponent("CollapseItem"),f=E(null);let C=0;const V=N,d=k,s=O({get(){return V.modelValue},set(c){d("update:modelValue",c)}}),t=E([]),p=O(()=>V.eventList.filter(c=>c.events.length)),m=O(()=>V.eventList.map(c=>c.events).flat()),i=E({});m.value.forEach(c=>{i.value[c.type]=O({get(){var o;var a;return(o=(a=s.value)==null?void 0:a[c.type])!=null?o:[]},set(a){a&&a.length?s.value[c.type]=a.map(o=>G(o)):delete s.value[c.type]}})}),q(()=>p.value,c=>{c.length&&(t.value=c.filter(a=>{for(let o=0;o<a.events.length;o++){const l=a.events[o].type;if(i.value[l].length)return!0}return!1}).map(a=>a.title))},{immediate:!0});let e="";function _(c){var a;(a=f.value)==null||a.handleOpen(),e=c}function w(c,a,o){var l;(l=f.value)==null||l.handleOpenEdit(o),C=c,e=a}function B(c){var a;i.value[e][C]=c,s.value[e]=[...(a=i.value[e])!=null?a:[]]}function M(c){var a,o;if(!s.value){s.value={[e]:[...(a=i.value[e])!=null?a:[],c]};return}s.value[e]=[...(o=i.value[e])!=null?o:[],c]}return(c,a)=>(v(),y(U,null,[x(g(r),{modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=o=>t.value=o),activeKey:t.value,"onUpdate:activeKey":a[2]||(a[2]=o=>t.value=o),"expanded-names":t.value,"onUpdate:expandedNames":a[3]||(a[3]=o=>t.value=o)},{default:z(()=>[(v(!0),y(U,null,R(p.value,o=>(v(),K(g(b),{key:o.title,title:o.title,header:o.title,name:o.title},{default:z(()=>[x(he,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l),"item-events":o.events,"all-events":m.value,events:i.value,onAdd:_,onEdit:w},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),x(De,{ref_key:"EActionModalRef",ref:f,onAdd:M,onEdit:B},null,512)],64))}});export{Be as default};
