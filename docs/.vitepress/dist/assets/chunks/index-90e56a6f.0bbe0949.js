import{i as z,r as _,m as A,w as Q,o as p,c as g,e as b,v as M,u as I,F as D,k as U,j as W,t as J,d as s,G as L,f as T,E as R,a4 as j,aa as P,ab as G,C as X,H as Y,I as H}from"../app.c1700df1.js";import{z as S,c9 as Z,cl as q,cm as ee}from"./index.52d9511d.js";import{m as K}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.b898144b.js";import{R as te}from"./vuedraggable.umd-6a5b6da9.96e89de6.js";import{e as ae}from"./tree.vue_vue_type_script_setup_true_lang-1ccf18a7.7ee066d0.js";const le={class:"event-info"},ne=["title"],oe={class:"event-btn"},ie={class:"epic-action-editor-main"},ce={class:"epic-editor-item"},ue={class:"w-36px text-lg"},se={class:"flex-1"},de={key:0},me={key:1},pe={key:2},ve={class:"opr-box"},re=["onClick"],fe=["onClick"],he=z({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(w,{emit:N}){const v=w,V=N,h=U("pageSchema");function E(o){V("add",o)}function C(o){return q(h.schemas,o).label}function r(o,f){var t;const i=n(f);i[f]=v.events[f].filter((e,O)=>o!==O),(t=i[f])!=null&&t.length||delete i[f],V("update:modelValue",i)}function m(o,f,t){V("edit",o,f,t)}function n(o){const f={};return v.allEvents.forEach(t=>{if(!v.events[t.type].length||t.type===o)return!1;f[t.type]=v.events[t.type]}),f}return(o,f)=>(p(!0),g(D,null,R(w.itemEvents,t=>(p(),g("div",{key:t.type,class:"event-item"},[s("div",le,[s("div",{class:"event-label",title:t.describe},j(t.describe),9,ne),s("div",oe,[b(I(K),{name:"icon-tianjia1",onClick:i=>E(t.type)},null,8,["onClick"])])]),s("div",ie,[b(I(te),{modelValue:v.events[t.type],"onUpdate:modelValue":i=>v.events[t.type]=i,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:M(({element:i,index:e})=>[s("div",ce,[s("div",ue,[b(I(K),{class:"mr-2 text-lg cursor-move handle",name:"icon-tuozhuai"})]),s("div",se,[i.type==="component"?(p(),g("div",de,j(C(i.componentId)),1)):i.type==="custom"?(p(),g("div",me," \u81EA\u5B9A\u4E49\u51FD\u6570 ")):i.type==="public"?(p(),g("div",pe," \u516C\u5171\u51FD\u6570 ")):X("",!0),T(" "+j(i.methodName),1)]),s("div",ve,[s("div",{class:"edit-btn",onClick:O=>m(e,t.type,i)},[b(I(K),{name:"icon-tiaozheng"})],8,re),s("div",{class:"del-btn",onClick:O=>r(e,t.type)},[b(I(K),{name:"icon-shanchu1"})],8,fe)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),ye={class:"h-full flex flex-col"},ge=s("div",{class:"pb-2"}," \u81EA\u5B9A\u4E49\u51FD\u6570\u7F16\u8F91 ",-1),Ie=z({__name:"EScriptEdit",setup(w){const N=S.getComponent("monacoEditor"),v={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},V=_(null),h=U("pageSchema");return(E,C)=>(p(),g("div",ye,[ge,b(I(N),{ref_key:"monacoEditorRef",ref:V,modelValue:I(h).script,"onUpdate:modelValue":C[0]||(C[0]=r=>I(h).script=r),class:"editor flex-1",config:v,language:"javascript"},null,8,["modelValue"])]))}}),xe={class:"epic-attribute-view"},Ce=["title"],Ve={class:"attr-input"},ke=z({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(w,{emit:N}){const v=w,V=N,h=A(()=>v.modelValue?JSON.parse(v.modelValue):[]);function E(r){var m;return typeof r.show=="boolean"?r.show:typeof r.show=="function"?(m=r.show)==null?void 0:m.call(r,{values:h.value}):!0}function C(r,m){var o;const n=[...JSON.parse((o=v.modelValue)!=null?o:"[]")];n[m]=r,V("update:modelValue",JSON.stringify(n))}return(r,m)=>(p(),g("aside",xe,[(p(!0),g(D,null,R(v.actionArgsConfigs,n=>(p(),g("div",{key:n.field+n.type},[P(s("div",{class:L(["attr-item",n.layout])},[s("div",{class:"attr-label",title:n.label},j(n.label),9,Ce),s("div",Ve,[b(I(Z),{componentSchema:{...n,componentProps:{...n.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":h.value[n.field],"onUpdate:modelValue":o=>C(o,n.field)},null,8,["componentSchema","model-value","onUpdate:modelValue"])])],2),[[G,E(n)]])]))),128))]))}}),be={class:"rounded bg-white epic-modal-action-main"},Ee={class:"epic-modal-left-panel h-full flex flex-col"},Ne={class:"flex flex-1 h-0 flex-col"},we={class:"flex-1 h-0"},_e={class:"epic-action-select h-30/100 flex flex-col"},Oe=s("div",{class:"mb-2"},"\u52A8\u4F5C\u9009\u62E9",-1),Ae={class:"flex-1 overflow-auto pr-8px"},Se=["onClick"],Ue={class:"text-center pt-42px text-gray-400"},je={class:"epic-modal-right-panel"},De={key:1,class:"text-center pt-42px text-gray-400"},ze=z({__name:"EActionModal",emits:["add","edit"],setup(w,{expose:N,emit:v}){const V=S.getComponent("modal"),h=_(!0),E=U("pageSchema"),C=U("pageManager",{}),r=U("designer"),m=_(!1),n=_([]),o=_(null),f=v,t=A(()=>{var d;return e.actionItem.type==="component"?o.value?(d=S.getComponentConfings()[o.value.type].config.action)==null?void 0:d.map(l=>({label:l.describe,value:l.type})):[]:e.actionItem.type==="custom"?Object.entries(C.funcs.value).filter(([l,x])=>typeof x=="function").map(([l])=>({label:l,value:l})):e.actionItem.type==="public"?Object.entries(S.publicMethods).map(([l])=>({label:l,value:l})):[]}),i=A(()=>{var d;if(e.actionItem.type==="component"&&o.value){const l=S.getComponentConfings()[o.value.type].config.action,x=l==null?void 0:l.find(y=>y.type===e.actionItem.methodName);if(x!=null&&x.argsConfigs){const y=x.argsConfigs.findIndex($=>$.label==="\u8BBE\u7F6E\u6570\u636E");y!==-1&&(x.argsConfigs[y]={...r.state.checkedNode,label:"\u8BBE\u7F6E\u6570\u636E",field:"0"})}return(d=x==null?void 0:x.argsConfigs)!=null?d:[]}return[]}),e=W({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}});function O(){var d;m.value=!0,h.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(d=t.value)!=null&&d.length&&k(t.value[0].value)}function B(d){if(m.value=!0,h.value=!1,o.value=null,d.componentId){const l=q(E.schemas,d.componentId);o.value=l,n.value=[d.componentId]}Y(()=>{e.actionItem.componentId=d.componentId,e.actionItem.methodName=d.methodName,e.actionItem.type=d.type,e.actionItem.args=d.args})}function F(){if(!e.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}f(h.value?"add":"edit",ee(H(e.actionItem))),u()}function u(){m.value=!1,n.value=[],e.cacheData={}}function a(d){var l;e.actionItem.componentId=null,e.actionItem.type=d,o.value=null,e.actionItem.methodName=null,n.value=[],(l=t.value)!=null&&l.length&&k(t.value[0].value)}function c(d){var l;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=d.id,e.actionItem.type="component",e.actionItem.methodName=null,o.value=d.componentSchema,(l=t.value)!=null&&l.length&&k(t.value[0].value)}function k(d){e.actionItem.methodName=d,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return N({handleOpen:O,handleOpenEdit:B}),(d,l)=>(p(),J(I(V),{modelValue:m.value,"onUpdate:modelValue":l[4]||(l[4]=x=>m.value=x),class:"w-1200px",width:"1200px",onClose:u,onOk:F,title:"\u52A8\u4F5C\u914D\u7F6E"},{default:M(()=>{var x;return[s("div",be,[s("div",Ee,[s("div",Ne,[s("div",{class:L(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:l[0]||(l[0]=y=>a("custom"))}," \u81EA\u5B9A\u4E49\u51FD\u6570 ",2),s("div",{class:L(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:l[1]||(l[1]=y=>a("public"))}," \u516C\u5171\u51FD\u6570 ",2),T(" \u7EC4\u4EF6 "),s("div",we,[b(I(ae),{selectedKeys:n.value,"onUpdate:selectedKeys":l[2]||(l[2]=y=>n.value=y),options:I(E).schemas,onNodeClick:c},null,8,["selectedKeys","options"])])]),s("div",_e,[Oe,s("div",Ae,[(p(!0),g(D,null,R(t.value,y=>(p(),g("div",{class:L([{checked:y.value===e.actionItem.methodName},"action-item"]),onClick:$=>k(y.value),key:y.value},[s("span",null,j(y.label),1)],10,Se))),128)),P(s("div",Ue,"\u5F53\u524D\u7EC4\u4EF6\u6682\u65E0\u52A8\u4F5C",512),[[G,!((x=t.value)!=null&&x.length)]])])])]),s("div",je,[e.actionItem.type==="custom"?(p(),J(Ie,{key:0})):i.value.length===0?(p(),g("div",De,"\u6682\u65E0\u914D\u7F6E")):(p(),J(ke,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":l[3]||(l[3]=y=>e.actionItem.args=y),actionArgsConfigs:i.value},null,8,["modelValue","actionArgsConfigs"]))])])]}),_:1},8,["modelValue"]))}}),Be=z({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(w,{emit:N}){const v=S.getComponent("Collapse"),V=S.getComponent("CollapseItem"),h=_(null);let E=0;const C=w,r=N,m=A({get(){return C.modelValue},set(u){r("update:modelValue",u)}}),n=_([]),o=A(()=>C.eventList.filter(u=>u.events.length)),f=A(()=>C.eventList.map(u=>u.events).flat()),t=_({});f.value.forEach(u=>{t.value[u.type]=A({get(){var c;var a;return(c=(a=m.value)==null?void 0:a[u.type])!=null?c:[]},set(a){a&&a.length?m.value[u.type]=a.map(c=>H(c)):delete m.value[u.type]}})}),Q(()=>o.value,u=>{u.length&&(n.value=u.filter(a=>{for(let c=0;c<a.events.length;c++){const k=a.events[c].type;if(t.value[k].length)return!0}return!1}).map(a=>a.title))},{immediate:!0});let i="";function e(u){var a;(a=h.value)==null||a.handleOpen(),i=u}function O(u,a,c){var k;(k=h.value)==null||k.handleOpenEdit(c),E=u,i=a}function B(u){var a;t.value[i][E]=u,m.value[i]=[...(a=t.value[i])!=null?a:[]]}function F(u){var a,c;if(!m.value){m.value={[i]:[...(a=t.value[i])!=null?a:[],u]};return}m.value[i]=[...(c=t.value[i])!=null?c:[],u]}return(u,a)=>(p(),g(D,null,[b(I(v),{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=c=>n.value=c),activeKey:n.value,"onUpdate:activeKey":a[2]||(a[2]=c=>n.value=c),"expanded-names":n.value,"onUpdate:expandedNames":a[3]||(a[3]=c=>n.value=c)},{default:M(()=>[(p(!0),g(D,null,R(o.value,c=>(p(),J(I(V),{key:c.title,title:c.title,header:c.title,name:c.title},{default:M(()=>[b(he,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=k=>m.value=k),"item-events":c.events,"all-events":f.value,events:t.value,onAdd:e,onEdit:O},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),b(ze,{ref_key:"EActionModalRef",ref:h,onAdd:F,onEdit:B},null,512)],64))}});export{Be as default};
