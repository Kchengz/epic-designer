import{i as H,r as C,k as B,m as A,b as ke,o as E,c as z,e as j,v as te,d as w,a3 as ie,w as P,aa as re,ab as ce,u as s,a4 as Ne,C as me,G as Z,F as Y,l as Se,p as Re,n as _e,q as Ee,t as ee,af as Ie,E as de,s as Ve,H as ge,B as $e,y as Te,ae as xe}from"../app.c1700df1.js";import{c8 as he,B as W,c9 as je,ca as Be,cb as Le,cc as De,cd as Oe,ce as ve,cf as ze,cg as ye,ch as Ae,ci as J,cj as ue,ck as Me}from"./index.c442f65c.js";import{m as se}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.b898144b.js";import{R as Ue}from"./vuedraggable.umd-6a5b6da9.96e89de6.js";const Je={class:"action-item whitespace-nowrap"},We={key:0,class:"flex"},Fe=H({__name:"previewWidgets",setup(M,{expose:S}){const p=B("pageManager",{}),h=B("pageSchema"),u=B("designer"),r=B("designerProps"),a=C(null),f=C(null),y=C(null),_=C(!1),i=C(!1),c=C(!0),o=C("top"),{canvasScale:d,disabledZoom:v}=he();let m=null;const D=A(()=>{const l=u.state.checkedNode;return!(!(l!=null&&l.id)||r.value.lockDefaultSchemaEdit&&p.defaultComponentIds.value.includes(l==null?void 0:l.id))}),L=A(()=>{var O;var l,g,x,V,b;const k=p.componentInstances.value,R=(l=u.state.checkedNode)==null?void 0:l.id,N=(O=W.getComponentConfingByType((g=u.state.checkedNode)==null?void 0:g.type))!=null?O:null;if(!R||!(k!=null&&k[R]))return null;if(N!=null&&N.defaultSchema.input&&((x=u.state.checkedNode)==null?void 0:x.noFormItem)!==!0)return(V=k[R+"formItem"])==null?void 0:V.$el;const T=k[R];return((b=T==null?void 0:T.$el)==null?void 0:b.nodeName)==="#text"?null:T==null?void 0:T.$el}),$=A(()=>{var T;var l,g,x,V;const b=p.componentInstances.value,k=(l=u.state.hoverNode)==null?void 0:l.id,R=(T=W.getComponentConfingByType((g=u.state.hoverNode)==null?void 0:g.type))!=null?T:null;if(!k||!(b!=null&&b[k]))return null;if(R!=null&&R.defaultSchema.input&&((x=u.state.hoverNode)==null?void 0:x.noFormItem)!==!0)return(V=b[k+"formItem"])==null?void 0:V.$el;const N=b[k];return(N==null?void 0:N.$el.nodeName)==="#text"?null:N==null?void 0:N.$el}),{mutationObserver:I,observerConfig:K}=le(n),{startTimedQuery:Q,stopTimedQuery:F}=ze(n);P(()=>L.value,l=>{if(l){_.value=!0,I.observe(l,K);const g=l.parentNode;g&&(g.ondragstart=()=>{c.value=!1,Q()},g.ondragend=()=>{c.value=!0,F()}),n()}else _.value=!1});const{mutationObserver:G,observerConfig:e}=le(U);P(()=>$.value,l=>{l&&(G.observe(l,e),U())});let t=0;P(()=>{var l;return(l=u.state.hoverNode)==null?void 0:l.id},l=>{if(l){i.value=!0,clearTimeout(t);return}t=setTimeout(()=>{i.value=!1},300)});function n(){var oe,X,q;const l=L.value;if(!l)return;const{top:g,left:x}=(oe=m==null?void 0:m.getBoundingClientRect())!=null?oe:{top:0,left:0},{top:V,left:b,width:k,height:R}=l.getBoundingClientRect(),N=v.value?1:d.value,T=V-g+((X=m==null?void 0:m.scrollTop)!=null?X:0)*N,O=b-x+((q=m==null?void 0:m.scrollLeft)!=null?q:0)*N,ae=R/N;a.value&&(a.value.style.width=`${k/N}px`,a.value.style.height=`${ae}px`,a.value.style.top=`${T/N}px`,a.value.style.left=`${O/N}px`),y.value&&(T<45&&ae<100?(y.value.style.top="",y.value.style.bottom="-30px",y.value.style["border-radius"]="0px 0px 4px 4px",o.value="bottom"):T<45?(y.value.style.top="0px",y.value.style["border-radius"]="0px 0px 4px 0",o.value="center"):(y.value.style.top="-30px",y.value.style["border-radius"]="4px 4px 0px 0px",o.value="top"))}function U(){var X,q,pe,fe;var l,g;const x=$.value;if(!x)return;const{top:V,left:b}=(X=m==null?void 0:m.getBoundingClientRect())!=null?X:{top:0,left:0},{top:k,left:R,width:N,height:T}=(q=(l=x.getBoundingClientRect)==null?void 0:l.call(x))!=null?q:(g=x.nextElementSibling)==null?void 0:g.getBoundingClientRect(),O=v.value?1:d.value,ae=k-V+((pe=m==null?void 0:m.scrollTop)!=null?pe:0)*O,oe=R-b+((fe=m==null?void 0:m.scrollLeft)!=null?fe:0)*O;f.value&&(f.value.style.width=`${N/O}px`,f.value.style.height=`${T/O}px`,f.value.style.top=`${ae/O}px`,f.value.style.left=`${oe/O}px`)}function le(l){const g=window.MutationObserver,x={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new g(l),observerConfig:x}}function ne(){var R;var l;const g=ye(h.schemas,(R=(l=u.state.checkedNode)==null?void 0:l.id)!=null?R:"root");if(!g)return!1;const{list:x,schema:V,index:b}=g,k=Ae(V);x.splice(b+1,0,k),u.setCheckedNode(k),J.push(h.schemas,"\u590D\u5236\u7EC4\u4EF6")}function we(){var k;var l;const g=ye(h.schemas,(k=(l=u.state.checkedNode)==null?void 0:l.id)!=null?k:"root");if(!g)return!1;let{list:x,schema:V,index:b}=g;x.splice(b,1),b===x.length&&b--,u.setCheckedNode(x[b]),J.push(h.schemas,"\u5220\u9664\u7EC4\u4EF6")}function Ce(l){m=l,m==null||m.addEventListener("scroll",()=>{n()}),ve(L,n),ve($,n)}return S({handleInit:Ce}),(l,g)=>{var N;var x,V,b,k,R;return E(),z(Y,null,[re(w("div",{ref_key:"selectorRef",ref:a,class:Z(["checked-widget absolute pointer-events-none z-20",o.value+" "+(c.value?"transition-all":"")])},[w("div",{class:"action-box",ref_key:"actionBoxRef",ref:y},[w("div",Je,Ne((V=s(W).getComponentConfingByType((N=(x=s(u).state.checkedNode)==null?void 0:x.type)!=null?N:""))==null?void 0:V.defaultSchema.label),1),D.value?(E(),z("div",We,[w("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:ne},[j(s(se),{name:"icon-fuzhi3"})]),w("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:we},[j(s(se),{name:"icon-shanchu1"})])])):me("",!0)],512)],2),[[ce,_.value&&((b=s(u).state.checkedNode)==null?void 0:b.id)!=="root"]]),re(w("div",{ref_key:"hoverWidgetRef",ref:f,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ce,i.value&&((k=s(u).state.checkedNode)==null?void 0:k.id)!==((R=s(u).state.hoverNode)==null?void 0:R.id)]])],64)}}}),Pe=H({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(M,{emit:S}){const p=B("designer"),h=B("pageSchema"),u=M,r=S,a=A({get(){return u.schemas},set(c){r("update:schemas",c)}});function f(c){p.setCheckedNode(a.value[c]),p.setDisableHover(!0)}function y(){p.setDisableHover(),J.push(h.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function _(){J.push(h.schemas,"\u63D2\u5165\u7EC4\u4EF6")}function i(c){return c.type==="page"||c.immovable?"unmover-item":"draggable-item"}return(c,o)=>(E(),ee(s(Ue),Te({modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value=d),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:o[1]||(o[1]=d=>f(d.oldIndex)),onEnd:o[2]||(o[2]=d=>y()),onAdd:o[3]||(o[3]=d=>{f(d.newIndex),_()})}),{item:te(({element:d,index:v})=>[(E(),z("div",{class:Z(["widget-box",i(d)]),key:v},[j(be,{schema:d},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),be=H({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(M){const S=Se(),p=B("designer"),h=B("pageManager",{}),u=C(null);Re("nodeAttrs",S);const r=M,a=A(()=>{var I;var i,c,o,d,v;const m=h.componentInstances.value,D=(i=r.schema)==null?void 0:i.id,L=(I=W.getComponentConfingByType((c=r.schema)==null?void 0:c.type))!=null?I:null;if(!D||!(m!=null&&m[D]))return null;if(L!=null&&L.defaultSchema.input&&((o=r.schema)==null?void 0:o.noFormItem)!==!0)return(d=m[D+"formItem"])==null?void 0:d.$el;const $=m[D];return((v=$==null?void 0:$.$el)==null?void 0:v.nodeName)==="#text"?null:$==null?void 0:$.$el});P(()=>a.value,i=>{i==null||i.addEventListener("click",f,!1),i==null||i.addEventListener("mouseover",y,!1),i==null||i.addEventListener("mouseout",_,!1)}),_e(()=>{var i,c,o;(i=a.value)==null||i.removeEventListener("click",f,!1),(c=a.value)==null||c.removeEventListener("mouseover",y,!1),(o=a.value)==null||o.removeEventListener("mouseout",_,!1)});function f(i){i.stopPropagation(),p.setCheckedNode(r.schema)}function y(i){r.schema.type!=="page"&&(i.stopPropagation(),p.setHoverNode(r.schema))}function _(i){i.stopPropagation(),p.setHoverNode(null)}return(i,c)=>{var o;const d=Ee("ENodeItem");return E(),ee(s(je),{ref_key:"nodeRef",ref:u,componentSchema:r.schema},Ie({_:2},[(o=r.schema)!=null&&o.childImmovable?{name:"edit-node",fn:te(()=>[(E(!0),z(Y,null,de(r.schema.children,v=>(E(),ee(d,{key:v.id,schema:v},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:te(()=>[r.schema.children?(E(),ee(Pe,{key:0,schemas:r.schema.children,"onUpdate:schemas":c[0]||(c[0]=v=>r.schema.children=v)},null,8,["schemas"])):me("",!0)]),key:"1"}]),1032,["componentSchema"])}}}),He={class:"min-w-750px rounded bg-white h-full"},Qe=H({__name:"previewJson",setup(M,{expose:S}){const p=W.getComponent("modal"),h=W.getComponent("monacoEditor"),u={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},r=C(null),a=C(!1),f=B("pageSchema");function y(){a.value=!1}function _(){a.value=!0,r.value?r.value.setValue(JSON.stringify(f,null,2)):setTimeout(()=>{_()},300)}function i(c="epic-data.json"){let o="data:text/json;charset=utf-8,";o+=JSON.stringify(f,null,2);var d=encodeURI(o),v=document.createElement("a");v.setAttribute("href",d),v.setAttribute("download",c),v.click()}return S({handleOpen:_}),(c,o)=>(E(),ee(s(p),{modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=d=>a.value=d),title:"\u67E5\u770B\u6570\u636E",class:"w-900px",width:"900px",onClose:y,onOk:i,okText:"\u5BFC\u51FA\u6570\u636E"},{default:te(()=>[w("div",He,[j(s(h),{ref_key:"monacoEditorRef",ref:r,class:"editor h-full",config:u,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Ze={class:"edit-toolbar flex items-center justify-between px-4"},Ke={class:"flex-1 h-full flex items-center"},Ge=["title","onClick"],Xe={class:"flex-1 h-full flex items-center justify-center"},qe=["title","onClick"],Ye={class:"flex-1 h-full flex items-center justify-end"},et={key:0,class:"flex items-center ml-12px"},tt={class:"pr-8px w-82px cursor-pointer"},lt={class:"w-90px cursor-pointer"},nt=H({__name:"toolbar",setup(M){const S=W.getComponent("slider"),p=W.getComponent("select"),{canvasScale:h,disabledZoom:u}=he(),r=C("pc"),a=B("pageSchema"),f=B("designer"),y=C(null),_=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],i=J.recordList,c=J.undoList,o=A(()=>[{icon:"icon-daima1",title:"\u67E5\u770B\u6570\u636E",on:()=>I()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:K},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:$},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:D,disabled:!i.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:L,disabled:!c.value.length}]),d=C(null),v=A({get(){return`${(h.value*100).toFixed(0)}%`},set(e){h.value=Number(e)}}),m=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function D(){const e=J.undo();e&&(ue(a.schemas,e),f.setCheckedNode(a.schemas[0]))}function L(){const e=J.redo();e&&(ue(a.schemas,e),f.setCheckedNode(a.schemas[0]))}function $(){f.reset()}function I(){y.value.handleOpen()}function K(){var e;(e=d.value)==null||e.click()}function Q(e){var t;const n=(t=e.target.files)==null?void 0:t[0];if(!n)return;e.target.value=null;const U=new FileReader;U.readAsText(n),U.onload=le=>{var ne;F((ne=le.target)==null?void 0:ne.result)}}function F(e){try{let t=JSON.parse(e!=null?e:"");t.schemas||(t=Me(t)),ue(a,t)}catch(t){console.error(t)}}function G(e){f.handleToggleDeviceMode(e),r.value=e;const t={pc:{},pad:{width:"800px",mode:e},mobile:{width:"420px",mode:e}};a.canvas=t[e]}return(e,t)=>(E(),z(Y,null,[w("div",Ze,[w("div",Ke,[(E(!0),z(Y,null,de(o.value,(n,U)=>(E(),z("div",{title:n.title,class:Z(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:n.disabled}]),key:U,onClick:n.on},[j(s(se),{name:n.icon},null,8,["name"])],10,Ge))),128))]),re(w("input",{type:"file",ref_key:"fileRef",ref:d,accept:".json,.txt",onChange:Q},null,544),[[ce,!1]]),w("div",Xe,[(E(),z(Y,null,de(_,n=>w("div",{title:n.title,class:Z(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:n.key===r.value}]),key:n.key,onClick:U=>G(n.key)},[j(s(se),{name:n.icon},null,8,["name"])],10,qe)),64))]),w("div",Ye,[s(u)?me("",!0):(E(),z("div",et,[w("div",tt,[j(s(p),{value:v.value,"onUpdate:value":t[0]||(t[0]=n=>v.value=n),modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=n=>v.value=n),options:m,size:"small"},null,8,["value","modelValue"])]),w("div",lt,[j(s(S),{min:.6,max:1.4,step:.01,tooltip:!1,value:s(h),"onUpdate:value":t[2]||(t[2]=n=>xe(h)?h.value=n:null),modelValue:s(h),"onUpdate:modelValue":t[3]||(t[3]=n=>xe(h)?h.value=n:null)},null,8,["value","modelValue"])])]))])]),j(Qe,{ref_key:"previewJson",ref:y},null,512)],64))}}),at={class:"h-full flex flex-col relative"},ot=["draggable"],it=H({__name:"editScreenContainer",setup(M){const S=B("pageSchema"),p=C(null),h=C(null),u=C(null),{pressSpace:r,disabledZoom:a}=he(),{handleElementDragStart:f,handleElementDrag:y,handleElementDragEnd:_}=Be(p),{width:i,height:c}=Le(p),{canvasScale:o,handleZoom:d}=De(h);let v=0,m=0;const D=C({}),L=C({}),$=C({}),I=Ve({width:0,height:0});P(()=>{var e,t;return{width:(e=S.canvas)==null?void 0:e.width,height:(t=S.canvas)==null?void 0:t.height}},Q),P($,()=>{ge(K)}),ke(()=>{var e,t;Q({width:(e=S.canvas)==null?void 0:e.width,height:(t=S.canvas)==null?void 0:t.height})});function K(){const e=s(u);e&&(I.value={width:e.clientWidth,height:e.clientHeight})}function Q({width:e,height:t}){$.value={width:e!=null?e:"0",height:t!=null?t:"0"}}Oe(i,F),P(I,F);function F(){if(a.value){L.value={width:v+"px",height:m+"px",transform:"translate(0px, 20px)"};return}let e=I.value.width||v,t=I.value.height||m;D.value={width:i.value+e+"px",height:c.value+t+"px"},L.value={width:e+"px",height:t+"px"},G()}function G(){ge(()=>{let e=I.value.width||v;const t=(I.value.height||m)/2,n=e/2;p.value.scrollTo(n,t)})}return ve(p,([{contentRect:e}])=>{if(v=e.width-60,m=e.height-80,!a.value)if(I.value.width===0)o.value=1;else{const t=(v-20)/I.value.width;o.value=t<1.2?t:o.value}F()}),(e,t)=>(E(),z("div",at,[j(nt),w("div",{ref_key:"editScreenContainerRef",ref:p,class:Z(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":s(r)}]),draggable:s(r),onWheel:t[0]||(t[0]=(...n)=>s(d)&&s(d)(...n)),onDragstart:t[1]||(t[1]=(...n)=>s(f)&&s(f)(...n)),onDragend:t[2]||(t[2]=(...n)=>s(_)&&s(_)(...n)),onDrag:t[3]||(t[3]=(...n)=>s(y)&&s(y)(...n))},[w("div",{id:"canvasContainer",class:"flex items-center justify-center",style:ie(D.value)},[w("div",{ref_key:"draggableElRef",ref:h,class:"transition-all"},[w("div",{class:Z({"pointer-events-none":s(r)}),style:ie(L.value)},[$e(e.$slots,"default")],6)],512)],4)],42,ot),w("div",{ref_key:"sizeBoxRef",ref:u,class:"absolute op-0 pointer-events-none",style:ie($.value)},null,4)]))}}),st={class:"epic-edit-canvas"},vt=H({__name:"index",setup(M){const S=C(null),p=C(null),h=B("pageSchema"),u=A(()=>h.schemas[0]),r=A(()=>({width:"100%",height:"100%"}));return ke(()=>{var a;(a=p.value)==null||a.handleInit(S.value)}),(a,f)=>(E(),z("section",st,[j(it,null,{default:te(()=>[w("div",{ref_key:"epicEditRangeRef",ref:S,class:"epic-edit-range rounded-md overflow-auto relative",style:ie(r.value)},[j(be,{schema:u.value},null,8,["schema"]),j(Fe,{ref_key:"ePreviewWidgetsRef",ref:p},null,512)],4)]),_:1})]))}});export{vt as default};
