import{i as P,r as b,k as D,m as J,b as ye,o as E,c as F,e as T,v as te,d as y,$ as oe,w as A,a6 as re,a7 as ce,u as r,a0 as we,V as Q,S as Y,l as Ce,p as Ne,n as Se,q as _e,t as ee,af as Re,a8 as de,C as be,s as Ie,I as fe,B as $e,y as Ee,ae as ge}from"../app.40ba1749.js";import{c8 as me,c6 as H,c9 as Ve,ca as Be,cb as Te,cc as je,cd as De,ce as ve,cf as Le,cg as xe,ch as Oe,ci as U,cj as ue,ck as Fe}from"./index.448dc4fe.js";import{m as ie}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.3c37508b.js";import{R as Me}from"./vuedraggable.umd-6a5b6da9.01edc059.js";const Ue={class:"action-item whitespace-nowrap"},He=P({__name:"previewWidgets",setup(M,{expose:C}){const h=D("pageManager",{}),m=D("pageSchema"),d=D("designer"),a=b(null),o=b(null),v=b(null),S=b(!1),_=b(!1),n=b(!0),c=b("top"),{canvasScale:u,disabledZoom:k}=me();let l=null;const R=J(()=>{var L;var s,p,f,$,x;const g=h.componentInstances.value,N=(s=d.state.checkedNode)==null?void 0:s.id,w=(L=H.getComponentConfingByType((p=d.state.checkedNode)==null?void 0:p.type))!=null?L:null;if(!N||!(g!=null&&g[N]))return null;if(w!=null&&w.defaultSchema.input&&((f=d.state.checkedNode)==null?void 0:f.noFormItem)!==!0)return($=g[N+"formItem"])==null?void 0:$.$el;const B=g[N];return((x=B==null?void 0:B.$el)==null?void 0:x.nodeName)==="#text"?null:B==null?void 0:B.$el}),V=J(()=>{var B;var s,p,f,$;const x=h.componentInstances.value,g=(s=d.state.hoverNode)==null?void 0:s.id,N=(B=H.getComponentConfingByType((p=d.state.hoverNode)==null?void 0:p.type))!=null?B:null;if(!g||!(x!=null&&x[g]))return null;if(N!=null&&N.defaultSchema.input&&((f=d.state.hoverNode)==null?void 0:f.noFormItem)!==!0)return($=x[g+"formItem"])==null?void 0:$.$el;const w=x[g];return(w==null?void 0:w.$el.nodeName)==="#text"?null:w==null?void 0:w.$el}),{mutationObserver:O,observerConfig:j}=i(e),{startTimedQuery:I,stopTimedQuery:X}=Le(e);A(()=>R.value,s=>{if(s){S.value=!0,O.observe(s,j);const p=s.parentNode;p&&(p.ondragstart=()=>{n.value=!1,I()},p.ondragend=()=>{n.value=!0,X()}),e()}else S.value=!1});const{mutationObserver:W,observerConfig:Z}=i(t);A(()=>V.value,s=>{s&&(W.observe(s,Z),t())});let K=0;A(()=>{var s;return(s=d.state.hoverNode)==null?void 0:s.id},s=>{if(s){_.value=!0,clearTimeout(K);return}K=setTimeout(()=>{_.value=!1},300)});function e(){var ae,q,G;const s=R.value;if(!s)return;const{top:p,left:f}=(ae=l==null?void 0:l.getBoundingClientRect())!=null?ae:{top:0,left:0},{top:$,left:x,width:g,height:N}=s.getBoundingClientRect(),w=k.value?1:u.value,B=$-p+((q=l==null?void 0:l.scrollTop)!=null?q:0)*w,L=x-f+((G=l==null?void 0:l.scrollLeft)!=null?G:0)*w,ne=N/w;a.value&&(a.value.style.width=`${g/w}px`,a.value.style.height=`${ne}px`,a.value.style.top=`${B/w}px`,a.value.style.left=`${L/w}px`),v.value&&(B<45&&ne<100?(v.value.style.top="",v.value.style.bottom="-30px",v.value.style["border-radius"]="0px 0px 4px 4px",c.value="bottom"):B<45?(v.value.style.top="0px",v.value.style["border-radius"]="0px 0px 4px 0",c.value="center"):(v.value.style.top="-30px",v.value.style["border-radius"]="4px 4px 0px 0px",c.value="top"))}function t(){var q,G,he,pe;var s,p;const f=V.value;if(!f)return;const{top:$,left:x}=(q=l==null?void 0:l.getBoundingClientRect())!=null?q:{top:0,left:0},{top:g,left:N,width:w,height:B}=(G=(s=f.getBoundingClientRect)==null?void 0:s.call(f))!=null?G:(p=f.nextElementSibling)==null?void 0:p.getBoundingClientRect(),L=k.value?1:u.value,ne=g-$+((he=l==null?void 0:l.scrollTop)!=null?he:0)*L,ae=N-x+((pe=l==null?void 0:l.scrollLeft)!=null?pe:0)*L;o.value&&(o.value.style.width=`${w/L}px`,o.value.style.height=`${B/L}px`,o.value.style.top=`${ne/L}px`,o.value.style.left=`${ae/L}px`)}function i(s){const p=window.MutationObserver,f={childList:!0,attributes:!0,subtree:!0};return{mutationObserver:new p(s),observerConfig:f}}function z(){var N;var s;const p=xe(m.schemas,(N=(s=d.state.checkedNode)==null?void 0:s.id)!=null?N:"root");if(!p)return!1;const{list:f,schema:$,index:x}=p,g=Oe($);f.splice(x+1,0,g),d.setCheckedNode(g),U.push(m.schemas,"\u590D\u5236\u7EC4\u4EF6")}function se(){var g;var s;const p=xe(m.schemas,(g=(s=d.state.checkedNode)==null?void 0:s.id)!=null?g:"root");if(!p)return!1;let{list:f,schema:$,index:x}=p;f.splice(x,1),x===f.length&&x--,d.setCheckedNode(f[x]),U.push(m.schemas,"\u5220\u9664\u7EC4\u4EF6")}function le(s){l=s,l==null||l.addEventListener("scroll",()=>{e()}),ve(R,e),ve(V,e)}return C({handleInit:le}),(s,p)=>{var w;var f,$,x,g,N;return E(),F(Y,null,[re(y("div",{ref_key:"selectorRef",ref:a,class:Q(["checked-widget absolute pointer-events-none z-20",c.value+" "+(n.value?"transition-all":"")])},[y("div",{class:"action-box",ref_key:"actionBoxRef",ref:v},[y("div",Ue,we(($=r(H).getComponentConfingByType((w=(f=r(d).state.checkedNode)==null?void 0:f.type)!=null?w:""))==null?void 0:$.defaultSchema.label),1),y("div",{title:"\u590D\u5236",class:"action-item pointer-events-auto",onClick:z},[T(r(ie),{name:"icon-fuzhi3"})]),y("div",{title:"\u5220\u9664",class:"action-item pointer-events-auto",onClick:se},[T(r(ie),{name:"icon-shanchu1"})])],512)],2),[[ce,S.value&&((x=r(d).state.checkedNode)==null?void 0:x.id)!=="root"]]),re(y("div",{ref_key:"hoverWidgetRef",ref:o,class:"hover-widget absolute transition-all pointer-events-none z-998"},null,512),[[ce,_.value&&((g=r(d).state.checkedNode)==null?void 0:g.id)!==((N=r(d).state.hoverNode)==null?void 0:N.id)]])],64)}}}),Je=P({name:"EditNodeItem",__name:"editNodeItem",props:{schemas:{}},emits:["update:schemas"],setup(M,{emit:C}){const h=D("designer"),m=D("pageSchema"),d=M,a=C,o=J({get(){return d.schemas},set(n){a("update:schemas",n)}});function v(n){h.setCheckedNode(o.value[n]),h.setDisableHover(!0)}function S(){h.setDisableHover(),U.push(m.schemas,"\u62D6\u62FD\u7EC4\u4EF6")}function _(){U.push(m.schemas,"\u63D2\u5165\u7EC4\u4EF6")}return(n,c)=>(E(),ee(r(Me),Ee({modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=u=>o.value=u),"item-key":"id","component-data":{type:"transition-group"},class:"draggable-range"},{animation:200,group:"edit-draggable",handle:".draggable-item",ghostClass:"moveing"},{onStart:c[1]||(c[1]=u=>v(u.oldIndex)),onEnd:c[2]||(c[2]=u=>S()),onAdd:c[3]||(c[3]=u=>{v(u.newIndex),_()})}),{item:te(({element:u,index:k})=>[(E(),F("div",{class:Q(["widget-box",{"draggable-item":!u.immovable}]),key:k},[T(ke,{schema:u},null,8,["schema"])],2))]),_:1},16,["modelValue"]))}}),ke=P({name:"ENodeItem",__name:"nodeItem",props:{schema:{},name:{}},setup(M){const C=Ce(),h=D("designer"),m=D("pageManager",{}),d=b(null);Ne("nodeAttrs",C);const a=M,o=J(()=>{var I;var n,c,u,k,l;const R=m.componentInstances.value,V=(n=a.schema)==null?void 0:n.id,O=(I=H.getComponentConfingByType((c=a.schema)==null?void 0:c.type))!=null?I:null;if(!V||!(R!=null&&R[V]))return null;if(O!=null&&O.defaultSchema.input&&((u=a.schema)==null?void 0:u.noFormItem)!==!0)return(k=R[V+"formItem"])==null?void 0:k.$el;const j=R[V];return((l=j==null?void 0:j.$el)==null?void 0:l.nodeName)==="#text"?null:j==null?void 0:j.$el});A(()=>o.value,n=>{n==null||n.addEventListener("click",v,!1),n==null||n.addEventListener("mouseover",S,!1),n==null||n.addEventListener("mouseout",_,!1)}),Se(()=>{var n,c,u;(n=o.value)==null||n.removeEventListener("click",v,!1),(c=o.value)==null||c.removeEventListener("mouseover",S,!1),(u=o.value)==null||u.removeEventListener("mouseout",_,!1)});function v(n){n.stopPropagation(),h.setCheckedNode(a.schema)}function S(n){a.schema.type!=="page"&&(n.stopPropagation(),h.setHoverNode(a.schema))}function _(n){n.stopPropagation(),h.setHoverNode(null)}return(n,c)=>{var u;const k=_e("ENodeItem");return E(),ee(r(Ve),{ref_key:"nodeRef",ref:d,componentSchema:a.schema},Re({_:2},[(u=a.schema)!=null&&u.childImmovable?{name:"edit-node",fn:te(()=>[(E(!0),F(Y,null,de(a.schema.children,l=>(E(),ee(k,{key:l.id,schema:l},null,8,["schema"]))),128))]),key:"0"}:{name:"edit-node",fn:te(()=>[a.schema.children?(E(),ee(Je,{key:0,schemas:a.schema.children,"onUpdate:schemas":c[0]||(c[0]=l=>a.schema.children=l)},null,8,["schemas"])):be("",!0)]),key:"1"}]),1032,["componentSchema"])}}}),Ze={class:"min-w-750px rounded bg-white h-full"},ze=P({__name:"previewJson",setup(M,{expose:C}){const h=H.getComponent("modal"),m=H.getComponent("monacoEditor"),d={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1},readOnly:!0},a=b(null),o=b(!1),v=D("pageSchema");function S(){o.value=!1}function _(){o.value=!0,a.value?a.value.setValue(JSON.stringify(v,null,2)):setTimeout(()=>{_()},300)}function n(c="epic-data.json"){let u="data:text/json;charset=utf-8,";u+=JSON.stringify(v,null,2);var k=encodeURI(u),l=document.createElement("a");l.setAttribute("href",k),l.setAttribute("download",c),l.click()}return C({handleOpen:_}),(c,u)=>(E(),ee(r(h),{modelValue:o.value,"onUpdate:modelValue":u[0]||(u[0]=k=>o.value=k),title:"\u67E5\u770B\u6570\u636E",class:"w-900px",width:"900px",onClose:S,onOk:n,okText:"\u5BFC\u51FA\u6570\u636E"},{default:te(()=>[y("div",Ze,[T(r(m),{ref_key:"monacoEditorRef",ref:a,class:"editor h-full",config:d,language:"json"},null,512)])]),_:1},8,["modelValue"]))}}),Ae={class:"edit-toolbar flex items-center justify-between px-4 mx-1"},Pe={class:"flex-1 h-full flex items-center"},We=["title","onClick"],Ke={class:"flex-1 h-full flex items-center justify-center"},Qe=["title","onClick"],Xe={class:"flex-1 h-full flex items-center justify-end"},qe={key:0,class:"flex items-center ml-12px"},Ge={class:"pr-8px w-82px cursor-pointer"},Ye={class:"w-90px cursor-pointer"},et=P({__name:"toolbar",setup(M){const C=H.getComponent("slider"),h=H.getComponent("select"),{canvasScale:m,disabledZoom:d}=me(),a=b("pc"),o=D("pageSchema"),v=D("designer"),S=b(null),_=[{icon:"icon-a-diannaotoubu",title:"pc",key:"pc"},{icon:"icon-a-pingbantoubu",title:"\u5E73\u677F",key:"pad"},{icon:"icon-a-shoujitoubu",title:"\u624B\u673A",key:"mobile"}],n=U.recordList,c=U.undoList,u=J(()=>[{icon:"icon-daima1",title:"\u67E5\u770B\u6570\u636E",on:()=>I()},{icon:"icon-shangchuan1",title:"\u5BFC\u5165\u6570\u636E",on:X},{icon:"icon-shanchu1",title:"\u6E05\u7A7A",on:j},{icon:"icon-chexiao2x",title:"\u64A4\u9500",on:V,disabled:!n.value.length},{icon:"icon-fanhui2x",title:"\u91CD\u505A",on:O,disabled:!c.value.length}]),k=b(null),l=J({get(){return`${(m.value*100).toFixed(0)}%`},set(e){m.value=Number(e)}}),R=[{label:"60%",value:"0.6"},{label:"80%",value:"0.8"},{label:"100%",value:"1.0"},{label:"120%",value:"1.2"},{label:"140%",value:"1.4"}];function V(){const e=U.undo();e&&(ue(o.schemas,e),v.setCheckedNode(o.schemas[0]))}function O(){const e=U.redo();e&&(ue(o.schemas,e),v.setCheckedNode(o.schemas[0]))}function j(){v.reset()}function I(){S.value.handleOpen()}function X(){var e;(e=k.value)==null||e.click()}function W(e){var t;const i=(t=e.target.files)==null?void 0:t[0];if(!i)return;e.target.value=null;const z=new FileReader;z.readAsText(i),z.onload=se=>{var le;Z((le=se.target)==null?void 0:le.result)}}function Z(e){try{let t=JSON.parse(e!=null?e:"");t.schemas||(t=Fe(t)),ue(o,t)}catch(t){console.error(t)}}function K(e){a.value=e;const t={pc:{},pad:{width:"800px"},mobile:{width:"420px"}};o.canvas=t[e]}return(e,t)=>(E(),F(Y,null,[y("div",Ae,[y("div",Pe,[(E(!0),F(Y,null,de(u.value,(i,z)=>(E(),F("div",{title:i.title,class:Q(["action-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{disabled:i.disabled}]),key:z,onClick:i.on},[T(r(ie),{name:i.icon},null,8,["name"])],10,We))),128))]),re(y("input",{type:"file",ref_key:"fileRef",ref:k,accept:".json,.txt",onChange:W},null,544),[[ce,!1]]),y("div",Ke,[(E(),F(Y,null,de(_,i=>y("div",{title:i.title,class:Q(["device-item h-90% px-10px flex items-center hover:bg-gray-50 cursor-pointer",{checked:i.key===a.value}]),key:i.key,onClick:z=>K(i.key)},[T(r(ie),{name:i.icon},null,8,["name"])],10,Qe)),64))]),y("div",Xe,[r(d)?be("",!0):(E(),F("div",qe,[y("div",Ge,[T(r(h),{value:l.value,"onUpdate:value":t[0]||(t[0]=i=>l.value=i),modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=i=>l.value=i),options:R,size:"small"},null,8,["value","modelValue"])]),y("div",Ye,[T(r(C),{min:.6,max:1.4,step:.01,tooltip:!1,value:r(m),"onUpdate:value":t[2]||(t[2]=i=>ge(m)?m.value=i:null),modelValue:r(m),"onUpdate:modelValue":t[3]||(t[3]=i=>ge(m)?m.value=i:null)},null,8,["value","modelValue"])])]))])]),T(ze,{ref_key:"previewJson",ref:S},null,512)],64))}}),tt={class:"h-full flex flex-col relative"},lt=["draggable"],nt=P({__name:"editScreenContainer",setup(M){const C=D("pageSchema"),h=b(null),m=b(null),d=b(null),{pressSpace:a,disabledZoom:o}=me(),{handleElementDragStart:v,handleElementDrag:S,handleElementDragEnd:_}=Be(h),{width:n,height:c}=Te(h),{canvasScale:u,handleZoom:k}=je(m);let l=0,R=0;const V=b({}),O=b({}),j=b({}),I=Ie({width:0,height:0});A(()=>{var e,t;return{width:(e=C.canvas)==null?void 0:e.width,height:(t=C.canvas)==null?void 0:t.height}},W),A(j,()=>{fe(X)}),ye(()=>{var e,t;W({width:(e=C.canvas)==null?void 0:e.width,height:(t=C.canvas)==null?void 0:t.height})});function X(){const e=r(d);e&&(I.value={width:e.clientWidth,height:e.clientHeight})}function W({width:e,height:t}){j.value={width:e!=null?e:"0",height:t!=null?t:"0"}}De(n,Z),A(I,Z);function Z(){if(o.value){O.value={width:l+"px",height:R+"px",transform:"translate(0px, 20px)"};return}let e=I.value.width||l,t=I.value.height||R;V.value={width:n.value+e+"px",height:c.value+t+"px"},O.value={width:e+"px",height:t+"px"},K()}function K(){fe(()=>{let e=I.value.width||l;const t=(I.value.height||R)/2,i=e/2;h.value.scrollTo(i,t)})}return ve(h,([{contentRect:e}])=>{if(l=e.width-60,R=e.height-80,!o.value)if(I.value.width===0)u.value=1;else{const t=(l-20)/I.value.width;u.value=t<1.2?t:u.value}Z()}),(e,t)=>(E(),F("div",tt,[T(et),y("div",{ref_key:"editScreenContainerRef",ref:h,class:Q(["flex-1 overflow-auto overflow-y-hidden epic-edit-screen-container",{"cursor-grab":r(a)}]),draggable:r(a),onWheel:t[0]||(t[0]=(...i)=>r(k)&&r(k)(...i)),onDragstart:t[1]||(t[1]=(...i)=>r(v)&&r(v)(...i)),onDragend:t[2]||(t[2]=(...i)=>r(_)&&r(_)(...i)),onDrag:t[3]||(t[3]=(...i)=>r(S)&&r(S)(...i))},[y("div",{id:"canvasContainer",class:"flex items-center justify-center",style:oe(V.value)},[y("div",{ref_key:"draggableElRef",ref:m,class:"transition-all"},[y("div",{class:Q({"pointer-events-none":r(a)}),style:oe(O.value)},[$e(e.$slots,"default")],6)],512)],4)],42,lt),y("div",{ref_key:"sizeBoxRef",ref:d,class:"absolute op-0 pointer-events-none",style:oe(j.value)},null,4)]))}}),at={class:"epic-edit-canvas"},rt=P({__name:"index",setup(M){const C=b(null),h=b(null),m=D("pageSchema"),d=J(()=>m.schemas[0]),a=J(()=>({width:"100%",height:"100%"}));return ye(()=>{var o;(o=h.value)==null||o.handleInit(C.value)}),(o,v)=>(E(),F("section",at,[T(nt,null,{default:te(()=>[y("div",{ref_key:"epicEditRangeRef",ref:C,class:"epic-edit-range rounded-md overflow-auto relative",style:oe(a.value)},[T(ke,{schema:d.value},null,8,["schema"]),T(He,{ref_key:"ePreviewWidgetsRef",ref:h},null,512)],4)]),_:1})]))}});export{rt as default};
