import{d as q,av as W,j as y,aw as fe,G as me,h as _,x as j,R as ve,k as ge,o as z,b as G,I as r,w as g,l as v,n as d,m as a,P as K,a1 as pe,e as E,c as X,F as U,J as be,D as we,al as ke,am as _e,r as xe,T as Ie,ax as he}from"./framework.Bp6pYewT.js";import{R as ye,t as Ne,G as Z,v as J,B as Ce,U as ze,V as Ee,n as Te,W as w,X as Oe,Y as Le,$ as Re,a0 as Se,a1 as Ve,a2 as Xe,a3 as $e,w as Ae,a4 as L,a5 as N,r as Ye,z as Be}from"./index-D0Hjkk1x.DbREz0MF.js";import{u as Me,a as De}from"./index.Ds2ynwF9.js";import{d as Fe}from"./debounce.ClzP27_a.js";var Pe="Expected a function";function $(p,T,f){var x=!0,s=!0;if(typeof p!="function")throw new TypeError(Pe);return ye(f)&&(x="leading"in f?!!f.leading:x,s="trailing"in f?!!f.trailing:s),Fe(p,T,{leading:x,maxWait:T,trailing:s})}const He=Ne({urlList:{type:J(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:J(String)}}),We={close:()=>!0,switch:p=>Z(p),rotate:p=>Z(p)},je=["src","crossorigin"],Ge=q({name:"ElImageViewer"}),Ke=q({...Ge,props:He,emits:We,setup(p,{expose:T,emit:f}){var x;const s=p,C={CONTAIN:{name:"contain",icon:W(ze)},ORIGINAL:{name:"original",icon:W(Ee)}},{t:Q}=Me(),o=Te("image-viewer"),{nextZIndex:ee}=De(),R=y(),A=y([]),Y=fe(),I=y(!0),b=y(s.initialIndex),O=me(C.CONTAIN),l=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ae=y((x=s.zIndex)!=null?x:ee()),te=_(()=>{const{urlList:e}=s;return e.length<=1}),B=_(()=>b.value===0),M=_(()=>b.value===s.urlList.length-1),ne=_(()=>s.urlList[b.value]),se=_(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!s.infinite&&B.value)]),oe=_(()=>[o.e("btn"),o.e("next"),o.is("disabled",!s.infinite&&M.value)]),le=_(()=>{const{scale:e,deg:t,offsetX:n,offsetY:u,enableTransition:m}=l.value;let i=n/e,c=u/e;switch(t%360){case 90:case-270:[i,c]=[c,-i];break;case 180:case-180:[i,c]=[-i,-c];break;case 270:case-90:[i,c]=[-c,i];break}const h={transform:`scale(${e}) rotate(${t}deg) translate(${i}px, ${c}px)`,transition:m?"transform .3s":""};return O.value.name===C.CONTAIN.name&&(h.maxWidth=h.maxHeight="100%"),h});function S(){ie(),f("close")}function re(){const e=$(n=>{switch(n.code){case N.esc:s.closeOnPressEscape&&S();break;case N.space:F();break;case N.left:P();break;case N.up:k("zoomIn");break;case N.right:H();break;case N.down:k("zoomOut");break}}),t=$(n=>{const u=n.deltaY||n.deltaX;k(u<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});Y.run(()=>{L(document,"keydown",e),L(document,"wheel",t)})}function ie(){Y.stop()}function ue(){I.value=!1}function ce(e){I.value=!1,e.target.alt=Q("el.image.error")}function de(e){if(I.value||e.button!==0||!R.value)return;l.value.enableTransition=!1;const{offsetX:t,offsetY:n}=l.value,u=e.pageX,m=e.pageY,i=$(h=>{l.value={...l.value,offsetX:t+h.pageX-u,offsetY:n+h.pageY-m}}),c=L(document,"mousemove",i);L(document,"mouseup",()=>{c()}),e.preventDefault()}function D(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function F(){if(I.value)return;const e=Ye(C),t=Object.values(C),n=O.value.name,m=(t.findIndex(i=>i.name===n)+1)%e.length;O.value=C[e[m]],D()}function V(e){const t=s.urlList.length;b.value=(e+t)%t}function P(){B.value&&!s.infinite||V(b.value-1)}function H(){M.value&&!s.infinite||V(b.value+1)}function k(e,t={}){if(I.value)return;const{minScale:n,maxScale:u}=s,{zoomRate:m,rotateDeg:i,enableTransition:c}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":l.value.scale>n&&(l.value.scale=Number.parseFloat((l.value.scale/m).toFixed(3)));break;case"zoomIn":l.value.scale<u&&(l.value.scale=Number.parseFloat((l.value.scale*m).toFixed(3)));break;case"clockwise":l.value.deg+=i,f("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=i,f("rotate",l.value.deg);break}l.value.enableTransition=c}return j(ne,()=>{ve(()=>{const e=A.value[0];e!=null&&e.complete||(I.value=!0)})}),j(b,e=>{D(),f("switch",e)}),ge(()=>{var e,t;re(),(t=(e=R.value)==null?void 0:e.focus)==null||t.call(e)}),T({setActiveItem:V}),(e,t)=>(z(),G(he,{to:"body",disabled:!e.teleported},[r(Ie,{name:"viewer-fade",appear:""},{default:g(()=>[v("div",{ref_key:"wrapper",ref:R,tabindex:-1,class:d(a(o).e("wrapper")),style:K({zIndex:ae.value})},[v("div",{class:d(a(o).e("mask")),onClick:t[0]||(t[0]=pe(n=>e.hideOnClickModal&&S(),["self"]))},null,2),E(" CLOSE "),v("span",{class:d([a(o).e("btn"),a(o).e("close")]),onClick:S},[r(a(w),null,{default:g(()=>[r(a(Oe))]),_:1})],2),E(" ARROW "),a(te)?E("v-if",!0):(z(),X(U,{key:0},[v("span",{class:d(a(se)),onClick:P},[r(a(w),null,{default:g(()=>[r(a(Le))]),_:1})],2),v("span",{class:d(a(oe)),onClick:H},[r(a(w),null,{default:g(()=>[r(a(Re))]),_:1})],2)],64)),E(" ACTIONS "),v("div",{class:d([a(o).e("btn"),a(o).e("actions")])},[v("div",{class:d(a(o).e("actions__inner"))},[r(a(w),{onClick:t[1]||(t[1]=n=>k("zoomOut"))},{default:g(()=>[r(a(Se))]),_:1}),r(a(w),{onClick:t[2]||(t[2]=n=>k("zoomIn"))},{default:g(()=>[r(a(Ve))]),_:1}),v("i",{class:d(a(o).e("actions__divider"))},null,2),r(a(w),{onClick:F},{default:g(()=>[(z(),G(be(a(O).icon)))]),_:1}),v("i",{class:d(a(o).e("actions__divider"))},null,2),r(a(w),{onClick:t[3]||(t[3]=n=>k("anticlockwise"))},{default:g(()=>[r(a(Xe))]),_:1}),r(a(w),{onClick:t[4]||(t[4]=n=>k("clockwise"))},{default:g(()=>[r(a($e))]),_:1})],2)],2),E(" CANVAS "),v("div",{class:d(a(o).e("canvas"))},[(z(!0),X(U,null,we(e.urlList,(n,u)=>ke((z(),X("img",{ref_for:!0,ref:m=>A.value[u]=m,key:n,src:n,style:K(a(le)),class:d(a(o).e("img")),crossorigin:e.crossorigin,onLoad:ue,onError:ce,onMousedown:de},null,46,je)),[[_e,u===b.value]])),128))],2),xe(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var Ue=Ae(Ke,[["__file","image-viewer.vue"]]);const ea=Be(Ue);export{ea as E,He as a,We as i,$ as t};
