import{i as j,r as E,m as O,w as Y,o as v,c as y,e as V,v as M,u as h,S,k as R,j as G,t as D,d as u,V as L,f as J,a8 as B,a0 as A,a6 as F,a7 as P,C as H,I as Q,aa as T}from"../app.40ba1749.js";import{cq as U,cs as W,ct as q,cu as X}from"./index.448dc4fe.js";import{m as z}from"./icon.vue_vue_type_script_setup_true_lang-3f9e4127.c7ab9899.js";import{R as Z}from"./vuedraggable.umd-9da3e665.a0b7836e.js";import{e as ee}from"./tree.vue_vue_type_script_setup_true_lang-1a5f0f1e.9aa5a927.js";const te={class:"event-info"},ae=["title"],le={class:"event-btn"},ne={class:"epic-action-editor-main"},oe={class:"epic-editor-item"},ie={class:"w-36px text-lg"},ce={class:"flex-1"},ue={key:0},se={key:1},me={key:2},de={class:"opr-box"},pe=["onClick"],ve=["onClick"],re=j({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(N,{emit:k}){const r=N,x=k,f=R("pageSchema");function b(p){x("add",p)}function g(p){return q(f.schemas,p).label}function d(p,m){var i;const e=a(m);e[m]=r.events[m].filter((w,_)=>p!==_),(i=e[m])!=null&&i.length||delete e[m],x("update:modelValue",e)}function s(p,m,i){x("edit",p,m,i)}function a(p){const m={};return r.allEvents.forEach(i=>{if(!r.events[i.type].length||i.type===p)return!1;m[i.type]=r.events[i.type]}),m}return(p,m)=>(v(!0),y(S,null,B(N.itemEvents,i=>(v(),y("div",{key:i.type,class:"event-item"},[u("div",te,[u("div",{class:"event-label",title:i.describe},A(i.describe),9,ae),u("div",le,[V(h(z),{name:"icon-tianjia1",onClick:e=>b(i.type)},null,8,["onClick"])])]),u("div",ne,[V(h(Z),{modelValue:r.events[i.type],"onUpdate:modelValue":e=>r.events[i.type]=e,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:M(({element:e,index:w})=>[u("div",oe,[u("div",ie,[V(h(z),{class:"mr-2 text-lg cursor-move handle",name:"icon-tuozhuai"})]),u("div",ce,[e.type==="component"?(v(),y("div",ue,A(g(e.componentId)),1)):e.type==="custom"?(v(),y("div",se," \u81EA\u5B9A\u4E49\u51FD\u6570 ")):e.type==="public"?(v(),y("div",me," \u516C\u5171\u51FD\u6570 ")):H("",!0),J(" "+A(e.methodName),1)]),u("div",de,[u("div",{class:"edit-btn",onClick:_=>s(w,i.type,e)},[V(h(z),{name:"icon-tiaozheng"})],8,pe),u("div",{class:"del-btn",onClick:_=>d(w,i.type)},[V(h(z),{name:"icon-shanchu1"})],8,ve)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),fe={class:"h-full flex flex-col"},ye=u("div",{class:"pb-2"}," \u81EA\u5B9A\u4E49\u51FD\u6570\u7F16\u8F91 ",-1),he=j({__name:"EScriptEdit",setup(N){const k=U.getComponent("monacoEditor"),r={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},x=E(null),f=R("pageSchema");return(b,g)=>(v(),y("div",fe,[ye,V(h(k),{ref_key:"monacoEditorRef",ref:x,modelValue:h(f).script,"onUpdate:modelValue":g[0]||(g[0]=d=>h(f).script=d),class:"editor flex-1",config:r,language:"javascript"},null,8,["modelValue"])]))}}),ge={class:"epic-attribute-view"},Ie=["title"],xe={class:"attr-input"},Ve=j({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(N,{emit:k}){const r=N,x=k,f=O(()=>r.modelValue?JSON.parse(r.modelValue):[]);function b(d){var s;return typeof d.show=="boolean"?d.show:typeof d.show=="function"?(s=d.show)==null?void 0:s.call(d,{values:f.value}):!0}function g(d,s){var p;const a=[...JSON.parse((p=r.modelValue)!=null?p:"[]")];a[s]=d,x("update:modelValue",JSON.stringify(a))}return(d,s)=>(v(),y("aside",ge,[(v(!0),y(S,null,B(r.actionArgsConfigs,a=>(v(),y("div",{key:a.field+a.type},[F(u("div",{class:L(["attr-item",a.layout])},[u("div",{class:"attr-label",title:a.label},A(a.label),9,Ie),u("div",xe,[V(h(W),{componentSchema:{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":f.value[a.field],"onUpdate:modelValue":p=>g(p,a.field)},null,8,["componentSchema","model-value","onUpdate:modelValue"])])],2),[[P,b(a)]])]))),128))]))}}),be={class:"rounded bg-white epic-modal-action-main"},ke={class:"epic-modal-left-panel h-full flex flex-col"},Ce={class:"flex flex-1 h-0 flex-col"},Ne={class:"flex-1 h-0"},Ee={class:"epic-action-select h-30/100 flex flex-col"},we=u("div",{class:"mb-2"},"\u52A8\u4F5C\u9009\u62E9",-1),_e={class:"flex-1 overflow-auto pr-8px"},Oe=["onClick"],Ue={class:"text-center pt-42px text-gray-400"},Ae={class:"epic-modal-right-panel"},Se={key:1,class:"text-center pt-42px text-gray-400"},je=j({__name:"EActionModal",emits:["add","edit"],setup(N,{expose:k,emit:r}){const x=U.getComponent("modal"),f=E(!0),b=R("pageSchema"),g=R("pageManager",{}),d=E(!1),s=E([]),a=E(null),p=r,m=O(()=>{var l;return e.actionItem.type==="component"?a.value?(l=U.getComponentConfings()[a.value.type].config.action)==null?void 0:l.map(n=>({label:n.describe,value:n.type})):[]:e.actionItem.type==="custom"?Object.entries(g.funcs.value).filter(([n,C])=>typeof C=="function").map(([n])=>({label:n,value:n})):e.actionItem.type==="public"?Object.entries(U.publicMethods).map(([n])=>({label:n,value:n})):[]}),i=O(()=>{var l;if(e.actionItem.type==="component"&&a.value){console.log();const n=U.getComponentConfings()[a.value.type].config.action,C=n==null?void 0:n.find(I=>I.type===e.actionItem.methodName);return(l=C==null?void 0:C.argsConfigs)!=null?l:[]}return[]}),e=G({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}});function w(){var l;d.value=!0,f.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(l=m.value)!=null&&l.length&&o(m.value[0].value)}function _(l){if(d.value=!0,f.value=!1,a.value=null,l.componentId){const n=q(b.schemas,l.componentId);a.value=n,s.value=[l.componentId]}Q(()=>{e.actionItem.componentId=l.componentId,e.actionItem.methodName=l.methodName,e.actionItem.type=l.type,e.actionItem.args=l.args})}function $(){if(!e.actionItem.methodName){alert("\u8BF7\u5148\u9009\u62E9\u52A8\u4F5C\u65B9\u6CD5");return}p(f.value?"add":"edit",X(T(e.actionItem))),K()}function K(){d.value=!1,s.value=[],e.cacheData={}}function c(l){var n;e.actionItem.componentId=null,e.actionItem.type=l,a.value=null,e.actionItem.methodName=null,s.value=[],(n=m.value)!=null&&n.length&&o(m.value[0].value)}function t(l){var n;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=l.id,e.actionItem.type="component",e.actionItem.methodName=null,a.value=l.componentSchema,(n=m.value)!=null&&n.length&&o(m.value[0].value)}function o(l){e.actionItem.methodName=l,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return k({handleOpen:w,handleOpenEdit:_}),(l,n)=>(v(),D(h(x),{modelValue:d.value,"onUpdate:modelValue":n[4]||(n[4]=C=>d.value=C),class:"w-1200px",width:"1200px",onClose:K,onOk:$,title:"\u52A8\u4F5C\u914D\u7F6E"},{default:M(()=>{var C;return[u("div",be,[u("div",ke,[u("div",Ce,[u("div",{class:L(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:n[0]||(n[0]=I=>c("custom"))}," \u81EA\u5B9A\u4E49\u51FD\u6570 ",2),u("div",{class:L(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:n[1]||(n[1]=I=>c("public"))}," \u516C\u5171\u51FD\u6570 ",2),J(" \u7EC4\u4EF6 "),u("div",Ne,[V(h(ee),{selectedKeys:s.value,"onUpdate:selectedKeys":n[2]||(n[2]=I=>s.value=I),options:h(b).schemas,onNodeClick:t},null,8,["selectedKeys","options"])])]),u("div",Ee,[we,u("div",_e,[(v(!0),y(S,null,B(m.value,I=>(v(),y("div",{class:L([{checked:I.value===e.actionItem.methodName},"action-item"]),onClick:Ke=>o(I.value),key:I.value},[u("span",null,A(I.label),1)],10,Oe))),128)),F(u("div",Ue,"\u5F53\u524D\u7EC4\u4EF6\u6682\u65E0\u52A8\u4F5C",512),[[P,!((C=m.value)!=null&&C.length)]])])])]),u("div",Ae,[e.actionItem.type==="custom"?(v(),D(he,{key:0})):i.value.length===0?(v(),y("div",Se,"\u6682\u65E0\u914D\u7F6E")):(v(),D(Ve,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":n[3]||(n[3]=I=>e.actionItem.args=I),actionArgsConfigs:i.value},null,8,["modelValue","actionArgsConfigs"]))])])]}),_:1},8,["modelValue"]))}}),Be=j({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(N,{emit:k}){const r=U.getComponent("Collapse"),x=U.getComponent("CollapseItem"),f=E(null);let b=0;const g=N,d=k,s=O({get(){return g.modelValue},set(c){d("update:modelValue",c)}}),a=E([]),p=O(()=>g.eventList.filter(c=>c.events.length)),m=O(()=>g.eventList.map(c=>c.events).flat()),i=E({});m.value.forEach(c=>{i.value[c.type]=O({get(){var o;var t;return(o=(t=s.value)==null?void 0:t[c.type])!=null?o:[]},set(t){t&&t.length?s.value[c.type]=t.map(o=>T(o)):delete s.value[c.type]}})}),Y(()=>p.value,c=>{c.length&&(a.value=c.filter(t=>{for(let o=0;o<t.events.length;o++){const l=t.events[o].type;if(i.value[l].length)return!0}return!1}).map(t=>t.title))},{immediate:!0});let e="";function w(c){var t;(t=f.value)==null||t.handleOpen(),e=c}function _(c,t,o){var l;(l=f.value)==null||l.handleOpenEdit(o),b=c,e=t}function $(c){var t;i.value[e][b]=c,s.value[e]=[...(t=i.value[e])!=null?t:[]]}function K(c){var t,o;if(!s.value){s.value={[e]:[...(t=i.value[e])!=null?t:[],c]};return}s.value[e]=[...(o=i.value[e])!=null?o:[],c]}return(c,t)=>(v(),y(S,null,[V(h(r),{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value=o),activeKey:a.value,"onUpdate:activeKey":t[2]||(t[2]=o=>a.value=o),"expanded-names":a.value,"onUpdate:expandedNames":t[3]||(t[3]=o=>a.value=o)},{default:M(()=>[(v(!0),y(S,null,B(p.value,o=>(v(),D(h(x),{key:o.title,title:o.title,header:o.title,name:o.title},{default:M(()=>[V(re,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),"item-events":o.events,"all-events":m.value,events:i.value,onAdd:w,onEdit:_},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),V(je,{ref_key:"EActionModalRef",ref:f,onAdd:K,onEdit:$},null,512)],64))}});export{Be as default};
