import{d as j,j as E,h as O,x as G,o as p,c as h,I as x,w as R,m as y,F as U,N as L,ai as H,b as z,l as c,n as K,a as $,D as B,t as A,al as J,am as T,e as Q,R as W,ap as P}from"./framework.Bp6pYewT.js";import{T as S,s as X,l as Y,S as q,F as Z}from"./index-NP0d70UY.CIJ65HY9.js";import{m as M}from"./icon.vue_vue_type_script_setup_true_lang-BKjDMfHm.DAq6Hevl.js";import{R as ee}from"./vuedraggable.umd-Bo-O9gJ9.nAYIeQOV.js";import{e as te}from"./tree.vue_vue_type_script_setup_true_lang-C1TSJI95.CoHmS0We.js";const ae={class:"event-info"},le=["title"],ne={class:"event-btn"},oe={class:"epic-action-editor-main"},ie={class:"epic-editor-item"},ce={class:"w-36px text-lg"},ue={class:"flex-1"},se={key:0},me={key:1},de={key:2},pe={class:"opr-box"},ve=["onClick"],re=["onClick"],fe=j({__name:"EActionEditorItem",props:{itemEvents:{type:Array,default:()=>[]},allEvents:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>[]},events:{type:Object,default:()=>({})}},emits:["add","edit","update:modelValue"],setup(N,{emit:k}){const v=N,V=k,f=L("pageSchema");function C(r){V("add",r)}function g(r){return q(f.schemas,r).label}function d(r,m){var n;const e=a(m);e[m]=v.events[m].filter((_,w)=>r!==w),(n=e[m])!=null&&n.length||delete e[m],V("update:modelValue",e)}function s(r,m,n){V("edit",r,m,n)}function a(r){const m={};return v.allEvents.forEach(n=>{if(!v.events[n.type].length||n.type===r)return!1;m[n.type]=v.events[n.type]}),m}return(r,m)=>(p(!0),h(U,null,B(N.itemEvents,n=>(p(),h("div",{key:n.type,class:"event-item"},[c("div",ae,[c("div",{class:"event-label",title:n.describe},A(n.describe),9,le),c("div",ne,[x(y(M),{name:"icon-tianjia1",onClick:e=>C(n.type)},null,8,["onClick"])])]),c("div",oe,[x(y(ee),{modelValue:v.events[n.type],"onUpdate:modelValue":e=>v.events[n.type]=e,"item-key":"id","component-data":{type:"transition-group"},group:"option-list",handle:".handle",animation:200},{item:R(({element:e,index:_})=>[c("div",ie,[c("div",ce,[x(y(M),{class:"mr-2 text-lg cursor-move handle",name:"icon-tuozhuai"})]),c("div",ue,[e.type==="component"?(p(),h("div",se,A(g(e.componentId)),1)):e.type==="custom"?(p(),h("div",me," 自定义函数 ")):e.type==="public"?(p(),h("div",de," 公共函数 ")):Q("",!0),$(" "+A(e.methodName),1)]),c("div",pe,[c("div",{class:"edit-btn",onClick:w=>s(_,n.type,e)},[x(y(M),{name:"icon-tiaozheng"})],8,ve),c("div",{class:"del-btn",onClick:w=>d(_,n.type)},[x(y(M),{name:"icon-shanchu1"})],8,re)])])]),_:2},1032,["modelValue","onUpdate:modelValue"])])]))),128))}}),he={class:"h-full flex flex-col"},ye=c("div",{class:"pb-2"}," 自定义函数编辑 ",-1),ge=j({__name:"EScriptEdit",setup(N){const k=S.getComponent("monacoEditor"),v={theme:"vs-light",selectOnLineNumbers:!0,minimap:{enabled:!1}},V=E(null),f=L("pageSchema");return(C,g)=>(p(),h("div",he,[ye,x(y(k),{ref_key:"monacoEditorRef",ref:V,modelValue:y(f).script,"onUpdate:modelValue":g[0]||(g[0]=d=>y(f).script=d),class:"editor flex-1",config:v,language:"javascript"},null,8,["modelValue"])]))}}),Ie={class:"epic-attribute-view"},Ve=["title"],be={class:"attr-input"},xe=j({__name:"EArgsEditor",props:{modelValue:{},actionArgsConfigs:{}},emits:["update:modelValue"],setup(N,{emit:k}){const v=N,V=k,f=O(()=>v.modelValue?JSON.parse(v.modelValue):[]);function C(d){var s;return typeof d.show=="boolean"?d.show:typeof d.show=="function"?(s=d.show)==null?void 0:s.call(d,{values:f.value}):!0}function g(d,s){const a=[...JSON.parse(v.modelValue??"[]")];a[s]=d,V("update:modelValue",JSON.stringify(a))}return(d,s)=>(p(),h("div",Ie,[(p(!0),h(U,null,B(v.actionArgsConfigs,a=>(p(),h("div",{key:a.field+a.type},[J(c("div",{class:K(["attr-item",a.layout])},[c("div",{class:"attr-label",title:a.label},A(a.label),9,Ve),c("div",be,[x(y(X),{componentSchema:{...a,componentProps:{...a.componentProps,input:!1,field:void 0,hidden:!1},show:!0,noFormItem:!0},"model-value":f.value[a.field],"onUpdate:modelValue":r=>g(r,a.field)},null,8,["componentSchema","model-value","onUpdate:modelValue"])])],2),[[T,C(a)]])]))),128))]))}}),Ce={class:"rounded bg-white epic-modal-action-main"},ke={class:"epic-modal-left-panel h-full flex flex-col"},Ne={class:"flex flex-1 h-0 flex-col"},Ee={class:"flex-1 h-0"},_e={class:"epic-action-select h-30/100 flex flex-col"},we=c("div",{class:"mb-2"},"动作选择",-1),Oe={class:"flex-1 overflow-auto pr-8px"},Se=["onClick"],Ae={class:"text-center pt-42px text-gray-400"},Ue={class:"epic-modal-right-panel"},je={key:1,class:"text-center pt-42px text-gray-400"},De=j({__name:"EActionModal",emits:["add","edit"],setup(N,{expose:k,emit:v}){const V=S.getComponent("modal"),f=E(!0),C=L("pageSchema"),g=L("pageManager",{}),d=E(!1),s=E([]),a=E(null),r=v,m=O(()=>{var l;return e.actionItem.type==="component"?a.value?(l=S.getComponentConfings()[a.value.type].config.action)==null?void 0:l.map(t=>({label:t.describe,value:t.type})):[]:e.actionItem.type==="custom"?Object.entries(g.funcs.value).filter(([t,b])=>typeof b=="function").map(([t])=>({label:t,value:t})):e.actionItem.type==="public"?Object.entries(S.publicMethods).map(([t])=>({label:t,value:t})):[]}),n=O(()=>{if(e.actionItem.type==="component"&&a.value){const l=S.getComponentConfings()[a.value.type].config.action,t=l==null?void 0:l.find(b=>b.type===e.actionItem.methodName);if(t!=null&&t.argsConfigs){const b=t.argsConfigs.findIndex(I=>I.label==="设置数据");b!==-1&&(t.argsConfigs[b]={...a.value,label:"设置数据",field:"0",id:Y()})}return(t==null?void 0:t.argsConfigs)??[]}return[]}),e=H({actionItem:{type:"custom",methodName:"test",componentId:null},cacheData:{}});function _(){var l;d.value=!0,f.value=!0,e.actionItem.type="custom",e.actionItem.componentId=null,(l=m.value)!=null&&l.length&&u(m.value[0].value)}function w(l){if(d.value=!0,f.value=!1,a.value=null,l.componentId){const t=q(C.schemas,l.componentId);a.value=t,s.value=[l.componentId]}W(()=>{e.actionItem.componentId=l.componentId,e.actionItem.methodName=l.methodName,e.actionItem.type=l.type,e.actionItem.args=l.args})}function F(){if(!e.actionItem.methodName){alert("请先选择动作方法");return}r(f.value?"add":"edit",Z(P(e.actionItem))),D()}function D(){d.value=!1,s.value=[],e.cacheData={}}function i(l){var t;e.actionItem.componentId=null,e.actionItem.type=l,a.value=null,e.actionItem.methodName=null,s.value=[],(t=m.value)!=null&&t.length&&u(m.value[0].value)}function o(l){var t;e.actionItem.args&&(e.cacheData[e.actionItem.componentId+e.actionItem.methodName]=e.actionItem.args),e.actionItem.componentId=l.id,e.actionItem.type="component",e.actionItem.methodName=null,a.value=l.componentSchema,(t=m.value)!=null&&t.length&&u(m.value[0].value)}function u(l){e.actionItem.methodName=l,e.actionItem.args=e.cacheData[e.actionItem.componentId+e.actionItem.methodName]}return k({handleOpen:_,handleOpenEdit:w}),(l,t)=>(p(),z(y(V),{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=b=>d.value=b),class:"w-1200px",width:"1200px",onClose:D,onOk:F,title:"动作配置"},{default:R(()=>{var b;return[c("div",Ce,[c("div",ke,[c("div",Ne,[c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="custom"}]),onClick:t[0]||(t[0]=I=>i("custom"))}," 自定义函数 ",2),c("div",{class:K(["fun-btn",{checked:e.actionItem.type==="public"}]),onClick:t[1]||(t[1]=I=>i("public"))}," 公共函数 ",2),$(" 组件 "),c("div",Ee,[x(y(te),{selectedKeys:s.value,"onUpdate:selectedKeys":t[2]||(t[2]=I=>s.value=I),options:y(C).schemas,onNodeClick:o},null,8,["selectedKeys","options"])])]),c("div",_e,[we,c("div",Oe,[(p(!0),h(U,null,B(m.value,I=>(p(),h("div",{class:K([{checked:I.value===e.actionItem.methodName},"epic-action-item"]),onClick:Me=>u(I.value),key:I.value},[c("span",null,A(I.label),1)],10,Se))),128)),J(c("div",Ae," 当前组件暂无动作 ",512),[[T,!((b=m.value)!=null&&b.length)]])])])]),c("div",Ue,[e.actionItem.type==="custom"?(p(),z(ge,{key:0})):n.value.length===0?(p(),h("div",je," 暂无配置 ")):(p(),z(xe,{key:2,modelValue:e.actionItem.args,"onUpdate:modelValue":t[3]||(t[3]=I=>e.actionItem.args=I),actionArgsConfigs:n.value},null,8,["modelValue","actionArgsConfigs"]))])])]}),_:1},8,["modelValue"]))}}),Fe=j({__name:"index",props:{eventList:{type:Array,default:()=>[]},modelValue:{type:Object}},emits:["update:modelValue"],setup(N,{emit:k}){const v=S.getComponent("Collapse"),V=S.getComponent("CollapseItem"),f=E(null);let C=0;const g=N,d=k,s=O({get(){return g.modelValue},set(i){d("update:modelValue",i)}}),a=E([]),r=O(()=>g.eventList.filter(i=>i.events.length)),m=O(()=>g.eventList.map(i=>i.events).flat()),n=E({});m.value.forEach(i=>{n.value[i.type]=O({get(){var o;return((o=s.value)==null?void 0:o[i.type])??[]},set(o){o&&o.length?s.value[i.type]=o.map(u=>P(u)):delete s.value[i.type]}})}),G(()=>r.value,i=>{i.length&&(a.value=i.filter(o=>{for(let u=0;u<o.events.length;u++){const l=o.events[u].type;if(n.value[l].length)return!0}return!1}).map(o=>o.title))},{immediate:!0});let e="";function _(i){var o;(o=f.value)==null||o.handleOpen(),e=i}function w(i,o,u){var l;(l=f.value)==null||l.handleOpenEdit(u),C=i,e=o}function F(i){n.value[e][C]=i,s.value[e]=[...n.value[e]??[]]}function D(i){if(!s.value){s.value={[e]:[...n.value[e]??[],i]};return}s.value[e]=[...n.value[e]??[],i]}return(i,o)=>(p(),h(U,null,[x(y(v),{modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=u=>a.value=u),activeKey:a.value,"onUpdate:activeKey":o[2]||(o[2]=u=>a.value=u),"expanded-names":a.value,"onUpdate:expandedNames":o[3]||(o[3]=u=>a.value=u)},{default:R(()=>[(p(!0),h(U,null,B(r.value,u=>(p(),z(y(V),{key:u.title,title:u.title,header:u.title,name:u.title},{default:R(()=>[x(fe,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=l=>s.value=l),"item-events":u.events,"all-events":m.value,events:n.value,onAdd:_,onEdit:w},null,8,["modelValue","item-events","all-events","events"])]),_:2},1032,["title","header","name"]))),128))]),_:1},8,["modelValue","activeKey","expanded-names"]),x(De,{ref_key:"EActionModalRef",ref:f,onAdd:D,onEdit:F},null,512)],64))}});export{Fe as default};
