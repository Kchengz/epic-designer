const __vite__fileDeps=["assets/chunks/index-B4P9zbh-.C8YYJ2Eu.js","assets/chunks/plugin-vue_export-helper-CHgC5LLL.lGy7RumW.js","assets/chunks/framework.C8YhLXwE.js","assets/chunks/index-BnSVsYF0.n68Fjfro.js","assets/chunks/icon.vue_vue_type_script_setup_true_lang-BKjDMfHm.D0t_j6sh.js","assets/chunks/index-Bjcutvrp.XmcmdcFZ.js","assets/chunks/index-BszLcUc6.sztk6cOB.js","assets/chunks/vuedraggable.umd-Bo-O9gJ9.CXDJdMaS.js","assets/chunks/commonjsHelpers-CT_km90n.D7mXbCtF.js","assets/chunks/index-BxO55XYc.BmQa8Vfg.js","assets/chunks/index-B8lJCe_7.BXbWfZT4.js","assets/chunks/index-DiDIFoTk.DhFvyf75.js","assets/chunks/index-ChklOJ5I.rRL2FcFA.js","assets/chunks/index-D0Y1lBAQ.RMpo29sI.js","assets/chunks/index-CuMx8fhC.C9EEpzjC.js","assets/chunks/tree.vue_vue_type_script_setup_true_lang-CpTWDrrR.Dj3XZShN.js","assets/chunks/index-D02bKlOx.DMtLuXCq.js","assets/chunks/index-DfcV7v-8.CIGAYRmt.js","assets/chunks/index-C11w5MtI.CYYLlK48.js","assets/chunks/index-wEzvyZ3R.BldVK1DT.js","assets/chunks/outline-C4NKbpYp.kqkOIhDB.js","assets/chunks/attributeView-B8Vmxqi8.BRnUOA_V.js","assets/chunks/styleView-Bsen85nn.BX4UImzS.js","assets/chunks/eventView-Bp-Piot5.Caoqtoyp.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{j as y,G as le,X as C,W as Ie,d as K,an as Q,x,N as Z,ak as ke,Z as T,h as $,z as _e,m as O,o as L,b as W,w as R,J as he,M as ae,I as B,as as ve,at as ge,r as N,e as we,E as Pe,a2 as Re,l as J,c as ue,F as Me,D as Oe,ba as Ce,n as Ve,aq as ee,R as te,ao as ye,az as Ne,aV as Te,aO as Le,am as Ge,k as ce}from"./framework.C8YhLXwE.js";var Fe=Object.defineProperty,$e=(t,e,n)=>e in t?Fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,V=(t,e,n)=>($e(t,typeof e!="symbol"?e+"":e,n),n);const F=(t,e)=>Ie({loader:t,loadingComponent:e,delay:80});function de(t=10){return Math.random().toString(36).substring(2,2+t)}function je(t){return t.charAt(0).toUpperCase()+t.slice(1)}function j(t,e=new WeakMap){if(typeof t!="object"||t===null)return t;if(e.has(t))return e.get(t);if(Array.isArray(t)){const i=t.map(o=>j(o,e));return e.set(t,i),i}const n={};return e.set(t,n),Object.keys(t).forEach(i=>{n[i]=j(t[i],e)}),n}function Ct(t){const[e]=Be([j(t)],n=>{var i,o;const a={...n,id:`${n.type}_${de(8)}`};return(a.field||a.input)&&!((o=(i=G.getComponentConfingByType(a.type))==null?void 0:i.editConstraints)!=null&&o.fixedField)&&(a.field=a.id),a});return e}function q(t,e){for(const[n,i]of Object.entries(e)){const o=t==null?void 0:t[n];o&&i&&typeof o=="object"&&typeof i=="object"?q(o,i):t[n]=i}Object.keys(t).reverse().forEach(n=>{e.hasOwnProperty(n)||(Array.isArray(e)?t.splice(n,1):delete t[n])})}function Se(t,e,n=[],i=new WeakMap){const o=a=>{if(Array.isArray(a))return a.map(o);if(typeof a=="object"&&a!==null){if(i.has(a))return"[Circular]";i.set(a,!0);const r=Object.keys(a).sort(),s={};return r.forEach(c=>{n.includes(c)||(s[c]=o(a[c]))}),i.delete(a),s}else return a};return JSON.stringify(o(t))===JSON.stringify(o(e))}function ze(t,e){const n=[];let i=!1;function o(a){if(n.push(a),a.id===e&&(i=!0),!i&&a.children!=null&&a.children.length>0)for(let r=0;r<a.children.length&&(o(a.children[r]),!i);r++);if(!i&&a.slots)for(let r in a.slots)for(let s=0;s<a.slots[r].length&&(o(a.slots[r][s]),!i);s++);i||n.pop()}return t.forEach(o),i||console.error(`没有查询到id为${e}的节点`),n}function St(t,e){const n=t.split(".");let i=e;for(let o=0;o<n.length;o++)if(i=i[n[o]],typeof i>"u")return;return i}function Et(t,e,n){const i=e.split(".");let o=n;i.forEach((a,r)=>{if(r===i.length-1){o[a]=t;return}o=o[a]??(o[a]={})})}function pe(t,e,n=!1,i){const o=[],a=[...t];for(;a.length;){const r=a.pop();if(r!=null&&r.children&&!i&&a.push(...r.children),r!=null&&r.slots&&!i)for(let s in r.slots)a.push(...r.slots[s]);if(e(r)&&(o.push(r),n))return r}return n?!1:o}function Be(t,e,n){const i=[...t];for(;i.length;){const o=i.pop();if(o!=null&&o.children&&!n&&i.push(...o.children),o!=null&&o.slots&&!n)for(let a in o.slots)i.push(...o.slots[a]);q(o,e(o))}return t}function Dt(t,e){const n=pe(t,i=>i.id===e,!0);if(!n)throw new Error(`没有查询到id为${e}的节点`);return n}function At(t,e){const n=[{type:"",children:t}];let i=0,o=null;if(pe(n,a=>{if(o=a.children??null,!o){if(a!=null&&a.slots)for(let r in a.slots){o=a.slots[r];for(let s=0;s<o.length;s++)if(o[s].id===e)return i=s,!0}return!1}for(let r=0;r<o.length;r++)if(o[r].id===e)return i=r,!0;return!1},!0),!o)throw new Error(`没有查询到id为${e}的节点`);return{list:o,schema:o[i],index:i}}function xt(t){const e={schemas:[{type:"page",id:"root",label:"页面",children:[{label:"表单",type:"form",icon:"epic-icon-daibanshixiang",labelWidth:t.config.labelWidth||100,name:"default",componentProps:{layout:t.config.layout||"horizontal",labelWidth:t.config.labelWidth||100,labelLayout:t.config.labelLayout==="flex"?"fixed":"flex",labelCol:t.config.labelCol||{span:5},wrapperCol:t.config.wrapperCol||{span:19},hideRequiredMark:t.config.hideRequiredMark||!1,colon:t.config.colon||!0,labelAlign:t.config.labelAlign||"right",size:t.config.size||"middle"},children:[],id:"form_"+de()}],componentProps:{style:{padding:"16px"}}}],script:t.script||""};return e.schemas[0].children[0].children=X(t.list),e}function X(t,e){return t.map(n=>{var i,o,a;let r=n.type??"";const s=n.options??{},c=(f,u)=>{r===f&&(r=u,s.defaultValue&&(s.defaultValue=JSON.parse(s.defaultValue)))};if(c("uploadImg","upload-image"),c("uploadFile","upload-file"),r==="date"&&s.range&&(s.type="daterange",delete s.range),(r==="date"||r==="time")&&(s.valueFormat=s.format),r==="textarea"){const{minRows:f,maxRows:u}=s;s.autoSize={minRows:f,maxRows:u},delete s.minRows,delete s.maxRows}r==="number"&&!s.precision&&delete s.precision,s.width&&(s.style={width:s.width},delete s.width),r==="grid"&&(r="row"),e&&e.type==="grid"&&(r="col",s.span=n.span,n.key=de());const d={label:n.label,type:r,icon:n.icon||"",field:n.model,componentProps:s,id:n.key};return(s.noFormItem||!s.showLabel)&&(d.noFormItem=!0,delete s.noFormItem,delete s.showLabel),s.clearable&&(s.allowClear=!0,delete s.clearable),["input","textarea","number","password","select","cascader","checkbox","radio","date","time","slider","switch","color-picker","upload-file","upload-image"].includes(r)&&(d.input=!0,((o=(i=n.rules)==null?void 0:i[0])==null?void 0:o.required)===!1&&n.rules.shift(),((a=n.rules)==null?void 0:a.length)>0&&(d.rules=n.rules)),n.list&&(d.children=X(n.list,n)),n.columns&&(d.children=X(n.columns,n)),n.trs&&(d.children=X(n.trs,n)),n.tds&&(d.children=X(n.tds,n)),d})}function me(t){return Te()?(Le(t),!0):!1}function He(t){let e=0,n,i;const o=()=>{e-=1,i&&e<=0&&(i.stop(),n=void 0,i=void 0)};return(...a)=>(e+=1,n||(i=Ne(!0),n=i.run(()=>t(...a))),me(o),n)}function Y(t){return typeof t=="function"?t():O(t)}const We=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Ze=Object.prototype.toString,Je=t=>Ze.call(t)==="[object Object]",qe=()=>{};function Ue(t){return ee()}function Xe(t,e=!0,n){Ue()?ce(t,n):e?t():te(t)}function Qe(t=!1,e={}){const{truthyValue:n=!0,falsyValue:i=!1}=e,o=Ge(t),a=y(t);function r(s){if(arguments.length)return a.value=s,a.value;{const c=Y(n);return a.value=a.value===c?Y(i):c,a.value}}return o?r:[a,r]}function It(t,e,n){const i=x(t,(...o)=>(te(()=>i()),e(...o)),n);return i}function H(t){var e;const n=Y(t);return(e=n==null?void 0:n.$el)!=null?e:n}const ne=We?window:void 0;function Ye(...t){let e,n,i,o;if(typeof t[0]=="string"||Array.isArray(t[0])?([n,i,o]=t,e=ne):[e,n,i,o]=t,!e)return qe;Array.isArray(n)||(n=[n]),Array.isArray(i)||(i=[i]);const a=[],r=()=>{a.forEach(f=>f()),a.length=0},s=(f,u,l,h)=>(f.addEventListener(u,l,h),()=>f.removeEventListener(u,l,h)),c=x(()=>[H(e),Y(o)],([f,u])=>{if(r(),!f)return;const l=Je(u)?{...u}:u;a.push(...n.flatMap(h=>i.map(p=>s(f,h,p,l))))},{immediate:!0,flush:"post"}),d=()=>{c(),r()};return me(d),d}function Ke(t){return typeof t=="function"?t:typeof t=="string"?e=>e.key===t:Array.isArray(t)?e=>t.includes(e.key):()=>!0}function Ee(...t){let e,n,i={};t.length===3?(e=t[0],n=t[1],i=t[2]):t.length===2?typeof t[1]=="object"?(e=!0,n=t[0],i=t[1]):(e=t[0],n=t[1]):(e=!0,n=t[0]);const{target:o=ne,eventName:a="keydown",passive:r=!1,dedupe:s=!1}=i,c=Ke(e);return Ye(o,a,d=>{d.repeat&&Y(s)||c(d)&&n(d)},r)}function se(t,e,n={}){return Ee(t,e,{...n,eventName:"keydown"})}function re(t,e,n={}){return Ee(t,e,{...n,eventName:"keyup"})}function et(){const t=y(!1),e=ee();return e&&ce(()=>{t.value=!0},e),t}function tt(t){const e=et();return $(()=>(e.value,!!t()))}function nt(t,e,n={}){const{window:i=ne,...o}=n;let a;const r=tt(()=>i&&"ResizeObserver"in i),s=()=>{a&&(a.disconnect(),a=void 0)},c=$(()=>Array.isArray(t)?t.map(u=>H(u)):[H(t)]),d=x(c,u=>{if(s(),r.value&&i){a=new ResizeObserver(e);for(const l of u)l&&a.observe(l,o)}},{immediate:!0,flush:"post"}),f=()=>{s(),d()};return me(f),{isSupported:r,stop:f}}function kt(t,e={width:0,height:0},n={}){const{window:i=ne,box:o="content-box"}=n,a=$(()=>{var u,l;return(l=(u=H(t))==null?void 0:u.namespaceURI)==null?void 0:l.includes("svg")}),r=y(e.width),s=y(e.height),{stop:c}=nt(t,([u])=>{const l=o==="border-box"?u.borderBoxSize:o==="content-box"?u.contentBoxSize:u.devicePixelContentBoxSize;if(i&&a.value){const h=H(t);if(h){const p=i.getComputedStyle(h);r.value=Number.parseFloat(p.width),s.value=Number.parseFloat(p.height)}}else if(l){const h=Array.isArray(l)?l:[l];r.value=h.reduce((p,{inlineSize:_})=>p+_,0),s.value=h.reduce((p,{blockSize:_})=>p+_,0)}else r.value=u.contentRect.width,s.value=u.contentRect.height},n);Xe(()=>{const u=H(t);u&&(r.value="offsetWidth"in u?u.offsetWidth:e.width,s.value="offsetHeight"in u?u.offsetHeight:e.height)});const d=x(()=>H(t),u=>{r.value=u?e.width:0,s.value=u?e.height:0});function f(){c(),d()}return{width:r,height:s,stop:f}}function Pt(){const{isDark:t}=oe(),e=Qe(t);return{isDark:t,toggleDark:e}}function ot(){const t=y(!1);return ce(()=>{it(t),at(t)}),x(()=>t.value,()=>{t.value?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}),{isDark:t}}function it(t){var e=document.documentElement;e&&(e.classList.contains("dark")?t.value=!0:t.value=!1)}function at(t){var e=document.querySelector("html"),n=new MutationObserver(function(i){for(var o of i)if(o.type==="attributes"&&o.attributeName==="class"){const a=o.target;new Array(...a.classList).includes("dark")?t.value=!0:t.value=!1}});n.observe(e,{attributes:!0,attributeFilter:["class"]}),_e(()=>{n.disconnect()})}function st(){const t=y(1),e=y(!1),{isDark:n}=ot(),{pressSpace:i,pressShift:o,pressCtrl:a}=rt();return{canvasScale:t,pressSpace:i,pressShift:o,pressCtrl:a,disabledZoom:e,isDark:n}}const oe=He(st);function rt(){const t=y(!1),e=y(!1),n=y(!1);return se(" ",i=>{var o=i.target;["INPUT","TEXTAREA"].includes(o.tagName)||i.preventDefault(),t.value=!0}),re(" ",()=>{t.value=!1}),se("Shift",i=>{i.preventDefault(),e.value=!0}),re("Shift",()=>{e.value=!1}),se("Control",i=>{i.preventDefault(),n.value=!0}),re("Control",()=>{n.value=!1}),{pressSpace:t,pressShift:e,pressCtrl:n}}function Rt(t){const{pressSpace:e}=oe();let n=0,i=0;function o(s){var c;n=s.x,i=s.y,(c=s.dataTransfer)==null||c.setDragImage(document.createElement("div"),0,0)}function a(s){if(s.preventDefault(),!s.x||!s.y||!e.value)return;const c=s.x-n,d=s.y-i;n=s.x,i=s.y,t.value&&(t.value.scrollTop-=d,t.value.scrollLeft-=c)}function r(){e.value=!1}return{handleElementDragStart:o,handleElementDrag:a,handleElementDragEnd:r}}function Mt(t){const{pressCtrl:e,canvasScale:n,disabledZoom:i}=oe();function o(a){if(!e.value||i.value)return;a.preventDefault();let r=0;a.deltaY<0?r=n.value+.05:r=n.value-.05,!(r>150||r<.5)&&(n.value=r)}return x(()=>n.value,a=>{t.value&&!i.value&&(t.value.style.transform=`scale(${a})`)}),{handleZoom:o,canvasScale:n}}function Ot(t,e=16.66){let n;function i(){o(),n=window.setInterval(t,e)}function o(){window.clearInterval(n)}return{startTimedQuery:i,stopTimedQuery:o}}function Vt(t,e){let n=null;return(...i)=>{n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i)},e)}}class lt{constructor(){V(this,"initialized",y(!1)),V(this,"components",{}),V(this,"componentConfigs",{}),V(this,"baseComponentTypes",[]),V(this,"componentSchemaGroups",y([])),V(this,"hiddenComponents",[]),V(this,"componentGroupNameMap",{}),V(this,"sortedGroups",["表单","布局"]),V(this,"viewsContainers",{activitybars:le([]),rightSidebars:le([])}),V(this,"publicMethods",{})}component(e,n){typeof n=="function"&&(n=F(n)),this.components[e]=n}registerComponent(e){this.component(e.defaultSchema.type,e.component),e.defaultSchema.input&&(e.config.action||(e.config.action=[]),e.config.action.unshift({type:"setValue",describe:"设置值",argsConfigs:[{...e.defaultSchema,label:"设置数据",field:"0"}]},{type:"getValue",describe:"获取值"})),this.componentConfigs[e.defaultSchema.type]=e,this.computedComponentSchemaGroups()}removeComponent(e){delete this.componentConfigs[e],delete this.components[e]}setBaseComponentTypes(e){this.baseComponentTypes=e}addBaseComponentTypes(e){this.baseComponentTypes.push(e)}removeBaseComponents(){this.baseComponentTypes.forEach(e=>{this.removeComponent(e)}),this.setBaseComponentTypes([]),this.computedComponentSchemaGroups()}getComponents(){return this.components}getComponent(e){return this.components[e]}registerActivitybar(e){typeof e.component=="function"&&(e.component=F(e.component)),typeof e.visible>"u"&&(e.visible=!0);const n=this.viewsContainers.activitybars.value.findIndex(i=>i.id===e.id);n!==-1?this.viewsContainers.activitybars.value[n]=e:this.viewsContainers.activitybars.value.push(e)}getActivitybars(){return this.viewsContainers.activitybars.value}hideActivitybar(e,n="title"){const i=this.viewsContainers.activitybars.value.findIndex(o=>o[n]===e);i!==-1&&(this.viewsContainers.activitybars.value[i].visible=!1)}showActivitybar(e,n="title"){const i=this.viewsContainers.activitybars.value.findIndex(o=>o[n]===e);i!==-1&&(this.viewsContainers.activitybars.value[i].visible=!0)}registerRightSidebar(e){typeof e.component=="function"&&(e.component=F(e.component)),typeof e.visible>"u"&&(e.visible=!0);const n=this.viewsContainers.rightSidebars.value.findIndex(i=>i.id===e.id);n!==-1?this.viewsContainers.rightSidebars.value[n]=e:this.viewsContainers.rightSidebars.value.push(e)}getRightSidebars(){return this.viewsContainers.rightSidebars.value}hideRightSidebar(e,n="title"){const i=this.viewsContainers.rightSidebars.value.findIndex(o=>o[n]===e);i!==-1&&(this.viewsContainers.rightSidebars.value[i].visible=!1)}showRightSidebar(e,n="title"){const i=this.viewsContainers.rightSidebars.value.findIndex(o=>o[n]===e);i!==-1&&(this.viewsContainers.rightSidebars.value[i].visible=!0)}getComponentConfings(){return this.componentConfigs}getComponentConfingByType(e){return this.componentConfigs[e]}computedComponentSchemaGroups(){const e=[];Object.values(this.componentConfigs).forEach(n=>{if(!this.hiddenComponents.includes(n.defaultSchema.type)&&n.groupName){const i=this.componentGroupNameMap[n.groupName]??n.groupName;let o=e.findIndex(r=>r.title===i);o===-1&&(e.push({title:i,list:[]}),o=e.length-1);let a=e[o].list.findIndex(r=>r.type===n.defaultSchema.type);a!==-1?e[o].list[a]=n.defaultSchema:e[o].list.push(n.defaultSchema)}}),e.sort((n,i)=>{const o=this.sortedGroups.indexOf(n.title),a=this.sortedGroups.indexOf(i.title);return o===-1?1:a===-1?-1:o-a}),this.componentSchemaGroups.value=e}getComponentSchemaGroups(){return this.componentSchemaGroups}setComponentGroupNameMap(e,n){this.componentGroupNameMap[e]=n}clearComponentGroupNameMap(){this.componentGroupNameMap={}}setSortedGroups(e){this.sortedGroups=e,this.computedComponentSchemaGroups()}clearSortedGroups(){this.sortedGroups=[],this.computedComponentSchemaGroups()}hideComponent(e){this.hiddenComponents.push(e),this.computedComponentSchemaGroups()}showComponent(e){this.hiddenComponents=this.hiddenComponents.filter(n=>n!==e),this.computedComponentSchemaGroups()}setHideComponents(e){this.hiddenComponents=e,this.computedComponentSchemaGroups()}setInitialized(e){this.initialized.value=e}addPublicMethod(e){const n=e.methodName??e.name,i=e.method??e.handler;this.publicMethods[n]={...e,name:n,handler:i}}removePublicMethod(e){delete this.publicMethods[e]}}const G=new lt;function De(){const t=y({}),e=y({}),n=y(!1),i=y([]);function o(l){return t.value[l]}function a(l,h){t.value[l]=h}function r(l){delete t.value[l]}function s(l,h=!1){const p=Object.entries(G.publicMethods).reduce((_,[I,m])=>(_[I]=m.handler,_),{});try{new Function(`const epic = this;${l}`).bind({...p,getComponent:o,find:o,defineExpose:c,publicMethods:p,pluginManager:G})()}catch(_){h&&console.error("[epic-desinger：自定义函数]异常：",_)}}function c(l){l!=null&&(e.value=l)}function d(l,...h){l==null||l.forEach(p=>{var _,I,m;if(p.type==="public"&&((_=G.publicMethods[p.methodName])==null||_.handler(...h)),p.type==="custom"&&((m=(I=e.value)[p.methodName])==null||m.call(I,...h)),p.type==="component"){(p.componentId!=null&&o(p.componentId))[p.methodName](...p.args?JSON.parse(p.args):h);return}})}function f(l=!0){n.value=l}function u(l){const h=pe(l,()=>!0);i.value=h.map(p=>p.id)}return{componentInstances:t,funcs:e,isDesignMode:n,defaultComponentIds:i,getComponentInstance:o,find:o,addComponentInstance:a,removeComponentInstance:r,setMethods:s,doActions:d,setDesignMode:f,setDefaultComponentIds:u}}function ut(){const t=y([]),e=y([]),n=y(null);let i=0;function o(s,c="插入组件"){const d=Date.now();i+150>d||(i=d,n.value!=null&&(t.value.push(n.value),e.value.splice(0,e.value.length)),n.value={type:c,componentSchema:JSON.stringify(s)},t.value.length>20&&t.value.unshift())}function a(){if(t.value.length===0)return!1;const s=t.value.pop();return n.value!=null&&e.value.push(n.value),n.value=s,JSON.parse(s.componentSchema)}function r(){if(e.value.length===0)return!1;const s=e.value.pop();return n.value!=null&&t.value.push(n.value),n.value=s,JSON.parse(s.componentSchema)}return{recordList:t,undoList:e,currentRecord:n,push:o,undo:a,redo:r}}const be=ut(),Ae=K({name:"ENode",__name:"node",props:{componentSchema:{},modelValue:{},ruleField:{},resetFormData:{},name:{}},emits:["update:modelValue","change"],setup(t,{emit:e}){const{proxy:n}=ee(),i=t;let o=Q(j(i.componentSchema));x(()=>i.componentSchema,g=>{Se(o,g,["children"])||q(o,j(g))},{deep:!0});let a=Z("formData",{});const r=Z("slots",{}),s=Z("pageManager",{}),c=Z("disabled",{value:!1}),d=Z("ruleFieldPrefix",null),f=Z("resetFormData",!1);(i.resetFormData||f)&&(a={});const u=e,l=G.getComponent("form-item"),h=y(),p=y(),_=ke();Object.keys(_).length&&T("nodeAttrs",_);const I=le(null),m=Q({}),S=$(()=>{var g,b;return(g=o.componentProps)!=null&&g.hidden?!1:typeof o.show=="boolean"?o.show:((b=o.show)==null?void 0:b.call(o,{values:a}))??!0}),P=$(()=>{var g;const b=S.value&&((g=o.rules)==null?void 0:g.map(D=>({...D,validator:D.validator&&s.funcs.value[D.validator]})));let A=o.field;i.ruleField?A=i.ruleField:d&&o.field&&(A=j(d),A.push(o.field));const k={...o,rules:b,rule:b,field:A};return k.children&&delete k.children,k}),w=$(()=>{var g,b;const A=((g=E.value)==null?void 0:g.bindModel)??"modelValue",k={};return o.on&&Object.keys(o.on).forEach(D=>{k[`on${je(D)}`]=(...xe)=>s.doActions(o.on[D],...xe)}),{...i,...o.componentProps,disabled:(c==null?void 0:c.value)||((b=o.componentProps)==null?void 0:b.disabled),bindModel:A,[`onUpdate:${A}`]:ie,...k}}),E=$(()=>G.getComponentConfingByType(o.type)??null),M=()=>a[o.field??""]??i.modelValue;x(()=>h.value,()=>{z()},{immediate:!0});function z(){var g;const b=h.value||n;o.id&&b&&(o.input&&(b.setValue=ie,b.getValue=()=>a[o.field]||i.modelValue),b.setAttr=(A,k)=>o.componentProps[A]=k,b.getAttr=A=>o.componentProps[A],s.addComponentInstance(o.id,b),(g=E.value)!=null&&g.defaultSchema.input&&o.noFormItem!==!0&&p.value&&s.addComponentInstance(o.id+"formItem",p.value))}function v(){var g;o.id&&(s.removeComponentInstance(o.id),(g=E.value)!=null&&g.defaultSchema.input&&o.noFormItem!==!0&&s.removeComponentInstance(o.id+"formItem"))}async function U(){var g,b,A;if(typeof((g=o.componentProps)==null?void 0:g.defaultValue)<"u"){const D=s.isDesignMode.value?(b=o.componentProps)==null?void 0:b.defaultValue:a[o.field]??((A=o.componentProps)==null?void 0:A.defaultValue);ie(j(D))}if(o.type==="slot"){const D=o.slotName;if(!D)return;I.value=K({setup(){return()=>N(r,D,{componentSchema:o,model:a})}});return}const k=G.getComponent(o.type);if(!k){console.error(`组件${o.type}未注册`);return}if(typeof k=="function"){const D=await k();I.value=D.default??D}else I.value=k}function ie(g){u("update:modelValue",g),u("change",g),o.field&&(a[o.field]=g)}let fe=null;return x(()=>o,g=>{const b=JSON.stringify({...g,children:void 0});if(b===fe)return!1;fe=b,U()},{immediate:!0,deep:!0}),_e(v),(g,b)=>{var A;const k=Pe("ENode");return O(o).noFormItem!==!0&&(A=E.value)!=null&&A.defaultSchema.input&&I.value&&S.value?(L(),W(O(l),ae({key:0,ref_key:"formItemRef",ref:p},P.value),{default:R(()=>[(L(),W(he(I.value),ae({ref_key:"componentInstance",ref:h,onVnodeMounted:z},{...w.value,...m,[w.value.bindModel]:M()}),{node:R(D=>[B(k,ve(ge(D)),null,16)]),"edit-node":R(()=>[N(g.$slots,"edit-node")]),_:3},16))]),_:3},16)):I.value&&S.value?(L(),W(he(I.value),ae({key:1,onVnodeMounted:z,ref_key:"componentInstance",ref:h,model:O(a)},{...w.value,...m,[w.value.bindModel]:M()}),{node:R(D=>[B(k,ve(ge(D)),null,16)]),"edit-node":R(()=>[N(g.$slots,"edit-node")]),_:3},16,["model"])):we("",!0)}}}),ct={key:0,class:"epic-loading-box"},dt={class:"epic-builder-main"},pt={class:"epic-loading-box"},Nt=K({__name:"builder",props:{pageSchema:{},disabled:{type:Boolean}},emits:["ready"],setup(t,{expose:e,emit:n}){const i=F(()=>C(()=>import("./index-B4P9zbh-.C8YYJ2Eu.js"),__vite__mapDeps([0,1,2]))),o=De(),a=n,r=Re(),s=y({}),c=y(!1),d=t,f=Q({schemas:[]});x(()=>d.pageSchema,m=>{q(f,m)},{immediate:!0,deep:!0}),x(()=>f.script,m=>{m&&m!==""&&o.setMethods(m,!0)},{immediate:!0}),T("slots",r),T("pageManager",o),T("forms",s),T("pageSchema",f),T("disabled",$(()=>d.disabled));function u(m="default"){return new Promise(async(S,P)=>{var w;if(!c.value){const z=x(c,async()=>{z(),S(await u(m))});return}const E=(w=s.value)==null?void 0:w[m];if(!E)return P(`表单 [name=${m}] 不存在`),!1;const M=j(await E.getData());S(M)})}function l(m="default"){return new Promise(async(S,P)=>{var w;if(!c.value){const M=x(c,async()=>{M(),S(await l(m))});return}const E=(w=s.value)==null?void 0:w[m];if(!E)return P(`表单 [name=${m}] 不存在`),!1;try{await E.validate();const M=await E.getData();S(M)}catch(M){P(M)}})}function h(m,S="default"){var P;if(!c.value){const E=x(c,()=>{E(),h(m,S)});return}const w=(P=s.value)==null?void 0:P[S];if(!w)return console.error(`表单 [name=${S}] 不存在`),!1;w.setData(m)}function p(m="default"){return new Promise(async(S,P)=>{var w;if(!c.value){const M=x(c,async()=>{M(),S(await p(m))});return}const E=(w=s.value)==null?void 0:w[m];if(!E)return P(`表单 [name=${m}] 不存在`),!1;S(E)})}const{proxy:_}=ee();function I(){te(()=>{c.value=!0,a("ready",o),_&&o.addComponentInstance("builder",_)})}return e({ready:c,getData:u,setData:h,validate:l,getFormInstance:p}),(m,S)=>O(G).initialized.value?(L(),W(Ce,{key:1,onResolve:I},{default:R(()=>[J("div",dt,[(L(!0),ue(Me,null,Oe(f.schemas,(P,w)=>(L(),W(O(Ae),{key:w,componentSchema:P},null,8,["componentSchema"]))),128))])]),fallback:R(()=>[J("div",pt,[B(O(i))])]),_:1})):(L(),ue("div",ct))}}),mt={key:0,class:"epic-loading-box"},ft={class:"epic-designer-main"},ht={class:"epic-header-container"},vt={class:"epic-loading-box"},Tt=K({__name:"designer",props:{disabledZoom:{type:Boolean,default:!1},hiddenHeader:{type:Boolean,default:!1},lockDefaultSchemaEdit:{type:Boolean,default:!1},title:{default:"EpicDesigner默认项目"},defaultSchema:{default:()=>({schemas:[{type:"page",id:"root",label:"页面",children:[],componentProps:{style:{padding:"16px"}}}],script:`const { defineExpose, find } = epic;

function test (){
    console.log('test')
}

// 通过defineExpose暴露的函数或者属性
defineExpose({
 test 
})`})}},emits:["ready","save","reset","toggleDeviceMode"],setup(t,{expose:e,emit:n}){const i=F(()=>C(()=>import("./index-BnSVsYF0.n68Fjfro.js"),__vite__mapDeps([3,4,2]))),o=F(()=>C(()=>import("./index-Bjcutvrp.XmcmdcFZ.js"),__vite__mapDeps([5,4,2]))),a=F(()=>C(()=>import("./index-BszLcUc6.sztk6cOB.js"),__vite__mapDeps([6,2,4,7,8]))),r=F(()=>C(()=>import("./index-BxO55XYc.BmQa8Vfg.js"),__vite__mapDeps([9,2,4]))),s=F(()=>C(()=>import("./index-B4P9zbh-.C8YYJ2Eu.js"),__vite__mapDeps([0,1,2]))),c=De(),d=t;c.setDesignMode(),c.setDefaultComponentIds(d.defaultSchema.schemas);const f=n,u=Q({checkedNode:null,hoverNode:null,disableHover:!1,matched:[]}),l=Q({schemas:[],script:d.defaultSchema.script}),{disabledZoom:h}=oe();x(()=>d.disabledZoom,v=>{h.value=v},{immediate:!0}),x(()=>l.script,v=>{v&&v!==""&&c.setMethods(v)},{immediate:!0}),T("pageSchema",l),T("pageManager",c),T("designerProps",$(()=>d)),T("designer",{setCheckedNode:_,setHoverNode:I,setDisableHover:S,handleToggleDeviceMode:z,reset:E,state:u});function p(){l.schemas=j(d.defaultSchema.schemas),_(l.schemas[0]),be.push(l.schemas,"初始化撤销功能")}async function _(v=l.schemas[0]){u.checkedNode=v,u.matched=ze(l.schemas,v.id)}async function I(v=null){var U;if(!v||u.disableHover)return u.hoverNode=null,!1;if((v==null?void 0:v.id)===((U=u.hoverNode)==null?void 0:U.id))return!1;u.hoverNode=v}function m(){te(()=>{f("ready",{pageManager:c})})}async function S(v=!1){u.disableHover=v}function P(v){q(l,v)}function w(){return ye(l)}function E(){Se(l.schemas,d.defaultSchema.schemas)&&l.script===d.defaultSchema.script||(q(l.schemas,d.defaultSchema.schemas),l.script=d.defaultSchema.script,_(l.schemas[0]),be.push(l.schemas,"重置操作"),f("reset",l))}function M(){f("save",ye(l))}function z(v){f("toggleDeviceMode",v)}return p(),e({setData:P,getData:w,reset:E}),(v,U)=>O(G).initialized.value?(L(),W(Ce,{key:1,onResolve:m},{default:R(()=>[J("div",ft,[J("div",ht,[N(v.$slots,"header",{},()=>[d.hiddenHeader?we("",!0):(L(),W(O(i),{key:0,onSave:M},{header:R(()=>[N(v.$slots,"header-prefix")]),prefix:R(()=>[N(v.$slots,"header-prefix")]),title:R(()=>[N(v.$slots,"header-title")]),"right-prefix":R(()=>[N(v.$slots,"header-right-prefix")]),"right-action":R(()=>[N(v.$slots,"header-right-action")]),"right-suffix":R(()=>[N(v.$slots,"header-right-suffix")]),_:3}))])]),J("div",{class:Ve(["epic-split-view-container",{"hidden-header":v.hiddenHeader}])},[B(O(o)),B(O(a)),B(O(r))],2)])]),fallback:R(()=>[J("div",vt,[B(O(s))])]),_:3})):(L(),ue("div",mt))}}),gt={component:async()=>await C(()=>import("./index-B8lJCe_7.BXbWfZT4.js").then(t=>t.i),__vite__mapDeps([10,2,1])),defaultSchema:{label:"代码编辑器",type:"monacoEditor",field:"monacoEditor",icon:"epic-icon-write",input:!0},config:{attribute:[{label:"字段名",type:"input",field:"field"},{label:"标题",type:"input",field:"label"},{label:"默认值",type:"monacoEditor",field:"componentProps.defaultValue"}]},bindModel:"model-value"},yt={component:async()=>await C(()=>import("./index-DiDIFoTk.DhFvyf75.js"),__vite__mapDeps([11,2])),defaultSchema:{label:"页面",type:"page",componentProps:{},children:[]},config:{attribute:[{label:"页面名称",type:"input",componentProps:{placeholder:"请输入"},field:"componentProps.name"}]}};function bt(t){t.component("EInputSize",async()=>await C(()=>import("./index-ChklOJ5I.rRL2FcFA.js"),__vite__mapDeps([12,2]))),t.component("EColEditor",async()=>await C(()=>import("./index-D0Y1lBAQ.RMpo29sI.js"),__vite__mapDeps([13,4,2]))),t.component("EActionEditor",async()=>await C(()=>import("./index-CuMx8fhC.C9EEpzjC.js"),__vite__mapDeps([14,2,4,7,8,15]))),t.component("ERuleEditor",async()=>await C(()=>import("./index-D02bKlOx.DMtLuXCq.js"),__vite__mapDeps([16,4,2]))),t.component("EOptionsEditor",async()=>await C(()=>import("./index-DfcV7v-8.CIGAYRmt.js"),__vite__mapDeps([17,2,7,8,4]))),t.component("ENode",async()=>await C(()=>Promise.resolve().then(()=>_t),void 0)),t.registerActivitybar({id:"component_view",title:"组件",icon:"epic-icon-mokuai_1",component:async()=>await C(()=>import("./index-C11w5MtI.CYYLlK48.js"),__vite__mapDeps([18,2,7,8,4]))}),t.registerActivitybar({id:"sound_code_view",title:"源码",icon:"epic-icon-daima1",component:async()=>await C(()=>import("./index-wEzvyZ3R.BldVK1DT.js"),__vite__mapDeps([19,2]))}),t.registerActivitybar({id:"outline_view",title:"大纲",icon:"epic-icon-juxingkaobei",component:async()=>await C(()=>import("./outline-C4NKbpYp.kqkOIhDB.js"),__vite__mapDeps([20,2,15,4,7,8]))}),t.registerRightSidebar({id:"attribute_view",title:"属性",component:async()=>await C(()=>import("./attributeView-B8Vmxqi8.BRnUOA_V.js"),__vite__mapDeps([21,2]))}),t.registerRightSidebar({id:"style_view",title:"样式",component:async()=>await C(()=>import("./styleView-Bsen85nn.BX4UImzS.js"),__vite__mapDeps([22,2]))}),t.registerRightSidebar({id:"event_view",title:"事件",component:async()=>await C(()=>import("./eventView-Bp-Piot5.Caoqtoyp.js"),__vite__mapDeps([23,2]))}),[gt,yt].forEach(e=>{t.registerComponent(e)})}bt(G);const _t=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));export{At as A,Ct as C,xt as D,Et as E,j as F,Nt as G,q as K,Pt as M,G as N,Mt as O,kt as P,Rt as R,Vt as T,Ot as V,It as _,Se as a,Tt as b,Ae as c,de as d,be as g,Dt as k,oe as o,nt as t,St as x};
