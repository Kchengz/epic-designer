import{d as V,a2 as A,Z as C,j as U,h as B,o as u,c as S,l as b,I as k,w as P,m as v,ai as F,aj as $,N as h,F as z,D as G,b as K,n as N,M as H,e as j,ah as w}from"./framework.C8YhLXwE.js";import{m as D}from"./icon.vue_vue_type_script_setup_true_lang-BKjDMfHm.D0t_j6sh.js";import{N as _}from"./index-DZavvwVo.CLpuZ4sn.js";import{R as J}from"./vuedraggable.umd-Bo-O9gJ9.CXDJdMaS.js";const I=V({name:"ETreeNodeItem",__name:"treeNodeItem",props:{schema:{}},setup(y){const e=y,m=h("slots",{}),d=h("expandedKeys"),i=h("treeProps"),f=h("selectedKeys"),r=h("handleSelect"),p=B(()=>d.value.includes(e.schema.id??"")),g=V({setup(){return()=>{var n;return w("span",{class:{text:!0,hover:i.hoverKey===e.schema.id,checked:f.value.includes(e.schema.id)},onClick:()=>r(e.schema.id,e.schema)},((n=m["tree-node"])==null?void 0:n.call(m,e))??w("span",{class:"epic-text-padding"},{default:()=>{var a;return[e.schema.label??((a=_.getComponentConfingByType(e.schema.type))==null?void 0:a.defaultSchema.label),w("span",{class:"epic-node-type-text"},e.schema.type)]}}))}}});function c(){const n=e.schema.id;if(!n)return!1;d.value.includes(n)?d.value=d.value.filter(a=>a!==n):d.value.push(n)}function o(){var n;const a=e.schema.id;if(!a||!((n=e.schema.children)!=null&&n.length))return!1;d.value.push(a)}return o(),(n,a)=>{var t,s,l;return u(),S("li",{class:N(["epic-tree-node",{expanded:(t=e.schema.children)==null?void 0:t.length,"level-1":e.schema.type==="page"}])},[b("a",null,[(s=e.schema.children)!=null&&s.length&&e.schema.type!=="page"?(u(),S("span",{key:0,class:N(["icon-expanded",{expanded:p.value}]),onClick:c},[k(v(D),{name:"icon-youjiantou"})],2)):j("",!0),k(v(g))]),(l=e.schema.children)!=null&&l.length?(u(),K(R,{key:0,class:N(["epic-tree-sublist",{expanded:p.value}]),schemas:e.schema.children,"onUpdate:schemas":a[0]||(a[0]=x=>e.schema.children=x),parentSchema:e.schema},null,8,["class","schemas","parentSchema"])):j("",!0)],2)}}}),L={key:1},R=V({name:"ETreeNodes",__name:"treeNodes",props:{schemas:{},parentSchema:{}},emits:["update:schemas"],setup(y,{emit:e}){const m=h("designer"),d=h("treeProps"),i=y,f=e,r=B({get(){return i.schemas},set(c){f("update:schemas",c)}});function p(c){m.setDisableHover(!0),m.setCheckedNode(r.value[c])}function g(c){var o;return c.type==="page"||(o=_.getComponentConfingByType(c.type).editConstraints)!=null&&o.immovable?"unmover-item":"draggable-item"}return(c,o)=>{var n,a,t,s;return(t=(a=v(_).getComponentConfingByType(((n=i.parentSchema)==null?void 0:n.type)||""))==null?void 0:a.editConstraints)!=null&&t.childImmovable?(u(),S("ul",L,[(u(!0),S(z,null,G(r.value,l=>(u(),K(I,{key:l.id,schema:l},null,8,["schema"]))),128))])):(u(),K(v(J),H({key:0,modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=l=>r.value=l),"item-key":"id","component-data":{},class:"epic-draggable-range"},{animation:200,tag:"ul",group:"tree-draggable",ghostClass:"moveing",draggable:".draggable-item",disabled:!v(d).draggable||((s=r.value[0])==null?void 0:s.type)==="page"},{onStart:o[1]||(o[1]=l=>p(l.oldIndex))}),{item:P(({element:l,index:x})=>[(u(),K(I,{class:N(g(l)),key:l.id,schema:l},null,8,["class","schema"]))]),_:1},16,["modelValue"]))}}}),M={class:"epic-tree h-full flex flex-col"},O={class:"epic-search-box px-10px py-6px"},Q={class:"epic-tree-main flex-1 overflow-auto h-0"},Z={class:"text-center pt-42px text-gray-400"},ee=V({name:"ETree",__name:"tree",props:{options:{type:Array,default:()=>[]},hoverKey:{type:String,default:""},selectedKeys:{type:Array,default:()=>[]},draggable:{type:Boolean,default:!1}},emits:["update:selectedKeys","nodeClick"],setup(y,{emit:e}){const m=A();C("slots",m);const d=_.getComponent("input"),i=U(""),f=U([]),r=y,p=e,g=B({get(){return r.selectedKeys},set(a){p("update:selectedKeys",a)}}),c=B({get(){return o(r.options,i.value)},set(a){console.log(a)}});function o(a,t){const s=[];return a.forEach(l=>{var x;if((x=l.label)!=null&&x.includes(t))s.push(l);else if(l.children){const E=o(l.children,t);if(E.length>0){const T={...l};T.children=E,s.push(T)}}}),s}function n(a,t){g.value=[a],p("nodeClick",{id:a,componentSchema:t})}return C("expandedKeys",f),C("selectedKeys",g),C("treeProps",r),C("handleSelect",n),(a,t)=>(u(),S("div",M,[b("div",O,[k(v(d),{placeholder:"搜索节点",clearable:"",allowClear:"",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),value:i.value,"onUpdate:value":t[1]||(t[1]=s=>i.value=s)},{prefix:P(()=>[k(v(D),{name:"icon-chaxun"})]),_:1},8,["modelValue","value"])]),b("div",Q,[b("ul",null,[k(R,{schemas:c.value,"onUpdate:schemas":t[2]||(t[2]=s=>c.value=s)},null,8,["schemas"])]),F(b("div",Z,"没有查询到的数据",512),[[$,!c.value.length]])])]))}});export{ee as e};
